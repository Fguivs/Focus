<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√âpicos ‰∫ó üå±</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoncRn8ikIdij8aXC0OUeqdqnLITrhmPc",
      authDomain: "foco-diario-75630.firebaseapp.com",
      projectId: "foco-diario-75630",
      storageBucket: "foco-diario-75630.appspot.com",
      messagingSenderId: "1040579676771",
      appId: "1:1040579676771:web:ca12f964d8adb3778e4656"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const membros = [
      "Gui", "Brenda", "Carlos", "Kamila", "Matt", "Sarah", "Steh",
      "Carla", "Clara", "Daniel", "Kaii", "Mich", "Monalisa",
      "Burigo", "Duda", "Felipe", "Gabrielle", "Piment√£o"
    ];
    const medalhas = {
      3: { emoji: "üî•", nome: "Fagulha" },
      10: { emoji: "üëë", nome: "Lenda" },
      30: { emoji: "üåü", nome: "Constante" },
      60: { emoji: "üíé", nome: "Diamante" },
      120: { emoji: "üöÄ", nome: "Foguete" },
      150: { emoji: "üèÜ", nome: "Trof√©u" },
      240: { emoji: "üîÆ", nome: "Bola de cristal" },
      365: { emoji: "üåû", nome: "Solar" }
    };
    const totalDiasMembros = {};
    const pontosSemanais = { abelha: 0, joaninha: 0, vagalume: 0 };
    const rankingGeral = { abelha: 0, joaninha: 0, vagalume: 0 };
    const historicoAcoes = {};
    
    // Vari√°vel de controle para evitar duplica√ß√£o
    let atualizando = false;
    
    // Vari√°vel para acompanhar a data atual
    let dataAtual = '';
    
    // Fun√ß√µes din√¢micas para data
    function getHoje() {
      return new Date();
    }
    
    function getHojeISO() {
      return getHoje().toISOString().slice(0, 10);
    }

    function formatarData(date) {
      const dia = String(date.getDate()).padStart(2, '0');
      const mes = String(date.getMonth() + 1).padStart(2, '0');
      const ano = date.getFullYear();
      return `${dia}/${mes}/${ano}`;
    }

    function getSemanaAtual() {
      const data = new Date();
      const diaSemana = data.getDay() || 7;
      const segunda = new Date(data);
      segunda.setDate(data.getDate() - diaSemana + 1);
      const sabado = new Date(segunda);
      sabado.setDate(segunda.getDate() + 5);
      const dataISO = new Date(data);
      dataISO.setHours(0, 0, 0, 0);
      dataISO.setDate(dataISO.getDate() + 4 - (dataISO.getDay() || 7));
      const anoInicio = new Date(dataISO.getFullYear(), 0, 1);
      const semanaNumero = Math.ceil((((dataISO - anoInicio) / 86400000) + 1) / 7);
      
      return {
        inicio: segunda,
        fim: sabado,
        numero: semanaNumero,
        inicioFormatado: formatarData(segunda),
        fimFormatado: formatarData(sabado),
        fimCompeticao: formatarData(sabado).slice(0, 5)
      };
    }

    async function salvarPresenca() {
      const presencas = {};
      membros.forEach(nome => {
        presencas[nome] = document.getElementById(nome).checked;
      });
      await setDoc(doc(db, "presencas", getHojeISO()), presencas);
      
      // Ap√≥s salvar, verificar √Årvore √âpica
      const totalCheckins = Object.values(presencas).filter(p => p).length;
      await verificarArvoreEpica(totalCheckins);
    }

    async function carregarPresenca() {
      const hojeISO = getHojeISO();
      const docSnap = await getDoc(doc(db, "presencas", hojeISO));
      
      if (!docSnap.exists()) {
        membros.forEach(nome => {
          document.getElementById(nome).checked = false;
        });
        return;
      }

      const data = docSnap.data();
      membros.forEach(nome => {
        document.getElementById(nome).checked = data[nome] || false;
      });
    }

    async function carregarTotalDias() {
      const querySnapshot = await getDocs(collection(db, "presencas"));
      membros.forEach(nome => {
        totalDiasMembros[nome] = 0;
      });
      querySnapshot.forEach(doc => {
        const data = doc.data();
        membros.forEach(nome => {
          if (data[nome]) {
            totalDiasMembros[nome]++;
          }
        });
      });
      atualizarMedalhas();
    }

    async function carregarPontosSemanais() {
      const semanaAtual = getSemanaAtual();
      const semanaDoc = await getDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)));
      if (semanaDoc.exists()) {
        const data = semanaDoc.data();
        pontosSemanais.abelha = data.abelha || 0;
        pontosSemanais.joaninha = data.joaninha || 0;
        pontosSemanais.vagalume = data.vagalume || 0;
      }
      atualizarPlacarSemanal();
    }

    async function carregarRankingGeral() {
      const rankingDoc = await getDoc(doc(db, "ranking", "geral"));
      if (rankingDoc.exists()) {
        const data = rankingDoc.data();
        rankingGeral.abelha = data.abelha || 0;
        rankingGeral.joaninha = data.joaninha || 0;
        rankingGeral.vagalume = data.vagalume || 0;
      }
      atualizarRankingGeral();
    }

    async function finalizarSemana() {
      const hoje = getHoje();
      if (hoje.getDay() === 0) {
        const semanaAtual = getSemanaAtual();
        const semanaDoc = await getDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)));
        
        if (semanaDoc.exists() && !semanaDoc.data().finalizada) {
          const pontos = semanaDoc.data();
          let vencedora = null;
          let maxPontos = 0;
          const equipesComPontuacao = [];
          
          if (pontos.abelha > maxPontos) {
            maxPontos = pontos.abelha;
            vencedora = "abelha";
          }
          if (pontos.joaninha > maxPontos) {
            maxPontos = pontos.joaninha;
            vencedora = "joaninha";
          }
          if (pontos.vagalume > maxPontos) {
            maxPontos = pontos.vagalume;
            vencedora = "vagalume";
          }
          
          if (pontos.abelha === maxPontos) equipesComPontuacao.push("abelha");
          if (pontos.joaninha === maxPontos) equipesComPontuacao.push("joaninha");
          if (pontos.vagalume === maxPontos) equipesComPontuacao.push("vagalume");
          
          const empate = equipesComPontuacao.length > 1;
          const rankingRef = doc(db, "ranking", "geral");
          
          if (!empate && vencedora) {
            await updateDoc(rankingRef, {
              [vencedora]: rankingGeral[vencedora] + 1
            });
            rankingGeral[vencedora]++;
            atualizarRankingGeral();
            
            const nomesEquipes = {
              abelha: "Abelha",
              joaninha: "Joaninha",
              vagalume: "Vaga-lume"
            };
            
            mostrarPopup("üèÜ Vit√≥ria Semanal", 
              `Equipe ${nomesEquipes[vencedora]} venceu a semana com ${maxPontos} pontos!`, 8000);
          } else if (empate) {
            const atualizacoes = {};
            const equipesEmpatadas = [];
            
            equipesComPontuacao.forEach(equipe => {
              atualizacoes[equipe] = rankingGeral[equipe] + 1;
              rankingGeral[equipe]++;
              equipesEmpatadas.push(equipe);
            });
            
            await updateDoc(rankingRef, atualizacoes);
            atualizarRankingGeral();
            
            const nomesEquipes = equipesEmpatadas.map(eq => {
              const nomes = {
                abelha: "Abelha",
                joaninha: "Joaninha",
                vagalume: "Vaga-lume"
              };
              return nomes[eq];
            }).join(", ");
            
            mostrarPopup("üèÜ Empate Semanal", 
              `As equipes ${nomesEquipes} empataram com ${maxPontos} pontos cada! Todas ganham um ponto no ranking.`, 8000);
          }
          
          await updateDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)), {
            finalizada: true,
            vencedora: empate ? null : vencedora
          });
        }
      }
    }

    function getMedalha(totalDias) {
      const niveis = Object.keys(medalhas).map(Number).sort((a, b) => b - a);
      for (const nivel of niveis) {
        if (totalDias >= nivel) {
          return medalhas[nivel];
        }
      }
      return null;
    }

    function atualizarMedalhas() {
      membros.forEach(nome => {
        const totalDias = totalDiasMembros[nome] || 0;
        const medalhaElement = document.getElementById(`medalha-${nome}`);
        const diasElement = document.getElementById(`dias-${nome}`);
        const medalha = getMedalha(totalDias);
        
        diasElement.textContent = `${totalDias}`;
        diasElement.title = `${totalDias} dias de foco`;
        
        if (medalha) {
          medalhaElement.innerHTML = medalha.emoji;
          medalhaElement.title = `${medalha.nome} - ${totalDias} dias de foco`;
          medalhaElement.classList.add('com-medalha');
          medalhaElement.classList.remove('escondido');
        } else {
          medalhaElement.innerHTML = '';
          medalhaElement.classList.remove('com-medalha');
          medalhaElement.classList.add('escondido');
        }
      });
    }

    function atualizarPlacarSemanal() {
      document.getElementById("resumo-abelha").innerHTML = `
        <div>${document.querySelectorAll('#equipe-abelha input:checked').length} focaram hoje!</div>
        <div>${pontosSemanais.abelha} pontos na semana</div>
      `;
      document.getElementById("resumo-joaninha").innerHTML = `
        <div>${document.querySelectorAll('#equipe-joaninha input:checked').length} focaram hoje!</div>
        <div>${pontosSemanais.joaninha} pontos na semana</div>
      `;
      document.getElementById("resumo-vagalume").innerHTML = `
        <div>${document.querySelectorAll('#equipe-vagalume input:checked').length} focaram hoje!</div>
        <div>${pontosSemanais.vagalume} pontos na semana</div>
      `;
    }

    function atualizarRankingGeral() {
      document.getElementById("ranking-abelha").textContent = rankingGeral.abelha;
      document.getElementById("ranking-joaninha").textContent = rankingGeral.joaninha;
      document.getElementById("ranking-vagalume").textContent = rankingGeral.vagalume;
    }

    window.atualizarResumo = async function () {
      if (atualizando) return;
      atualizando = true;
      
      const equipes = {
        abelha: ["Brenda", "Carlos", "Kamila", "Matt", "Sarah", "Steh"],
        joaninha: ["Carla", "Clara", "Daniel", "Kaii", "Mich", "Monalisa"],
        vagalume: ["Burigo", "Duda", "Felipe", "Gabrielle", "Piment√£o"]
      };

      // Obter estado atual do Firestore
      const hojeISO = getHojeISO();
      const docSnap = await getDoc(doc(db, "presencas", hojeISO));
      const estadoFirestore = docSnap.exists() ? docSnap.data() : {};

      // Calcular diferen√ßas baseadas no Firestore
      const diferencas = { abelha: 0, joaninha: 0, vagalume: 0 };
      
      for (const [equipe, membrosEquipe] of Object.entries(equipes)) {
        membrosEquipe.forEach(nome => {
          const estadoAtual = document.getElementById(nome).checked;
          const estadoSalvo = estadoFirestore[nome] || false;
          
          if (estadoAtual !== estadoSalvo) {
            if (estadoAtual) {
              diferencas[equipe]++;
            } else {
              diferencas[equipe]--;
            }
          }
        });
      }

      // Atualizar pontos semanais
      for (const equipe of Object.keys(equipes)) {
        pontosSemanais[equipe] = Math.max(0, pontosSemanais[equipe] + diferencas[equipe]);
      }

      // Salvar estado atual no Firestore
      await salvarPresenca();
      
      // Atualizar semana no Firestore
      const semanaAtual = getSemanaAtual();
      await updateDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)), pontosSemanais);
      
      // Atualizar UI
      const total = membros.filter(nome => document.getElementById(nome).checked).length;
      document.getElementById("contadorGeral").textContent = `${total} √©picos focaram hoje!`;
      const porcentagem = (total / membros.length) * 100;
      document.getElementById("progresso-barra").style.width = `${porcentagem}%`;
      
      atualizarPlacarSemanal();
      verificarEquipeCompleta();
      
      atualizando = false;
    }

    // Verificar se todos os membros de uma equipe est√£o focados
    function verificarEquipeCompleta() {
      const equipes = {
        abelha: ["Brenda", "Carlos", "Kamila", "Matt", "Sarah", "Steh"],
        joaninha: ["Carla", "Clara", "Daniel", "Kaii", "Mich", "Monalisa"],
        vagalume: ["Burigo", "Duda", "Felipe", "Gabrielle", "Piment√£o"]
      };
      
      for (const equipe in equipes) {
        const todosFocados = equipes[equipe].every(membro => 
          document.getElementById(membro).checked
        );
        
        const grupo = document.getElementById(`equipe-${equipe}`);
        if (todosFocados) {
          grupo.classList.add('equipe-completa', equipe);
        } else {
          grupo.classList.remove('equipe-completa', equipe);
        }
      }
    }

    window.mostrarPopup = function (titulo, mensagem, duracao = 8000) {
      const popup = document.getElementById("popup");
      popup.innerHTML = `<strong>${titulo}</strong><br>${mensagem}`;
      popup.classList.add("mostrar");
      popup.style.zIndex = "1001";
      clearTimeout(window.popupTimeout);
      window.popupTimeout = setTimeout(() => {
        popup.classList.remove("mostrar");
        setTimeout(() => popup.style.zIndex = "1000", 500);
      }, duracao);
    }

    const conquistas = {
      5: "üèÜ 5 dias consecutivos!",
      10: "üî• Fogo Sagrado! 10 dias!",
      15: "üöÄ N√≠vel √âpico! 15 dias!"
    };

    const medalhasConcedidas = {};
    
    async function verificarConquista(nome, acao) {
      if (!historicoAcoes[nome]) historicoAcoes[nome] = [];
      historicoAcoes[nome].push({ data: new Date(), acao: acao });
      
      // Atualizar contagem local de dias
      if (acao === 'adicionar') {
        totalDiasMembros[nome] = (totalDiasMembros[nome] || 0) + 1;
      } else if (acao === 'remover') {
        totalDiasMembros[nome] = Math.max(0, (totalDiasMembros[nome] || 0) - 1);
      }
      
      atualizarMedalhas();
      
      const docRef = doc(db, "streak", nome);
      const docSnap = await getDoc(docRef);
      let streak = docSnap.exists() ? docSnap.data().streak : 0;
      
      if (acao === 'adicionar') {
        streak += 1;
      } else if (acao === 'remover') {
        streak = Math.max(0, streak - 1);
      }
      
      await setDoc(docRef, { 
        streak: streak,
        ultimoDia: acao === 'adicionar' ? getHojeISO() : (docSnap.exists() ? docSnap.data().ultimoDia : null)
      });

      const medalha = getMedalha(totalDiasMembros[nome]);
      if (acao === 'adicionar' && medalha) {
        const niveis = Object.keys(medalhas).map(Number);
        const nivelAtual = niveis.find(nivel => nivel === totalDiasMembros[nome]);
        if (nivelAtual && (!medalhasConcedidas[nome] || medalhasConcedidas[nome].nome !== medalha.nome)) {
          medalhasConcedidas[nome] = medalha;
          const somConquista = document.getElementById("som-conquista");
          somConquista.currentTime = 0;
          somConquista.play();
          mostrarPopup("üèÖ Nova Medalha", `${nome} conquistou:<br>${medalha.emoji} ${medalha.nome}!`, 8000);
          dispararConfete();
        }
      }
      else if (acao === 'remover' && medalhasConcedidas[nome]) {
        const medalhaAtual = getMedalha(totalDiasMembros[nome]);
        if (!medalhaAtual || medalhaAtual.nome !== medalhasConcedidas[nome].nome) {
          mostrarPopup("‚ÑπÔ∏è Medalha Removida", `${nome} perdeu a medalha:<br>${medalhasConcedidas[nome].emoji} ${medalhasConcedidas[nome].nome}`, 5000);
          delete medalhasConcedidas[nome];
        }
      }
      
      if (conquistas[streak] && acao === 'adicionar') {
        const somConquista = document.getElementById("som-conquista");
        somConquista.currentTime = 0;
        somConquista.play();
        mostrarPopup("üåü Conquista", `${nome} conquistou:<br>${conquistas[streak]}`, 8000);
        dispararConfete();
      }
    }

    function dispararConfete() {
      const confettiCanvas = document.getElementById("confetti-canvas");
      const confettiCtx = confettiCanvas.getContext('2d');
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      const confettiParticles = [];
      
      // Reduzir n√∫mero de part√≠culas e aumentar velocidade
      for (let i = 0; i < 100; i++) {
        confettiParticles.push({
          x: Math.random() * confettiCanvas.width,
          y: -10,
          size: Math.random() * 10 + 5,
          speed: Math.random() * 8 + 5, // Aumento de velocidade
          color: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'][Math.floor(Math.random() * 5)],
          angle: Math.random() * Math.PI * 2,
          spin: Math.random() * 0.2 - 0.1
        });
      }
      
      function animateConfetti() {
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        let particlesAlive = 0;
        for (let i = 0; i < confettiParticles.length; i++) {
          const p = confettiParticles[i];
          // Aumentar gravidade para cair mais r√°pido
          p.y += p.speed * 0.8;
          p.x += Math.sin(p.angle) * 2;
          p.angle += p.spin;
          confettiCtx.fillStyle = p.color;
          confettiCtx.beginPath();
          confettiCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          confettiCtx.fill();
          if (p.y < confettiCanvas.height) particlesAlive++;
        }
        if (particlesAlive > 0) requestAnimationFrame(animateConfetti);
      }
      animateConfetti();
    }

    window.marcarCheckbox = function (nome) {
      const checkbox = document.getElementById(nome);
      const som = document.getElementById("som-check");
      som.currentTime = 0;
      som.play();
      const label = checkbox.nextElementSibling;
      if (checkbox.checked) label.classList.add('checked');
      else label.classList.remove('checked');
      const acao = checkbox.checked ? 'adicionar' : 'remover';
      verificarConquista(nome, acao);
      atualizarResumo();
      if (checkbox.checked) mostrarPopup("üéâ Foco Registrado", `${nome}, parab√©ns por ter focado hoje!`, 3000);
      else mostrarPopup("‚ÑπÔ∏è Foco Removido", `${nome}, seu foco de hoje foi removido`, 3000);

      // Adicionar destaque apenas no resumo da equipe do membro (exceto Gui)
      if (nome !== "Gui") {
        let equipe = "";
        if (["Brenda", "Carlos", "Kamila", "Matt", "Sarah", "Steh"].includes(nome)) equipe = "abelha";
        else if (["Carla", "Clara", "Daniel", "Kaii", "Mich", "Monalisa"].includes(nome)) equipe = "joaninha";
        else if (["Burigo", "Duda", "Felipe", "Gabrielle", "Piment√£o"].includes(nome)) equipe = "vagalume";
        
        if (equipe) {
          const resumo = document.getElementById(`resumo-${equipe}`);
          resumo.classList.add('destaque');
          setTimeout(() => resumo.classList.remove('destaque'), 500);
        }
      }
    }
    
    window.resetarTudo = async function() {
      if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Voc√™ est√° prestes a resetar TODOS os dados!\nIsso apagar√° todo o hist√≥rico e pontos.\n\nDeseja continuar?')) return;
      try {
        // Resetar dados no Firebase
        const presencasSnapshot = await getDocs(collection(db, "presencas"));
        for (const doc of presencasSnapshot.docs) await deleteDoc(doc.ref);
        const semanasSnapshot = await getDocs(collection(db, "semanas"));
        for (const doc of semanasSnapshot.docs) await deleteDoc(doc.ref);
        const streaksSnapshot = await getDocs(collection(db, "streak"));
        for (const doc of streaksSnapshot.docs) await deleteDoc(doc.ref);
        const rankingRef = doc(db, "ranking", "geral");
        await setDoc(rankingRef, { abelha: 0, joaninha: 0, vagalume: 0 });
        
        // Resetar vari√°veis locais
        pontosSemanais.abelha = 0;
        pontosSemanais.joaninha = 0;
        pontosSemanais.vagalume = 0;
        location.reload();
        mostrarPopup("‚úÖ Reset Completo", "Todos os dados foram resetados com sucesso!", 5000);
      } catch (error) {
        console.error("Erro ao resetar dados:", error);
        mostrarPopup("‚ùå Erro no Reset", "Ocorreu um erro ao tentar resetar os dados.", 5000);
      }
    }

    // ===== NOVAS FUN√á√ïES PARA A √ÅRVORE √âPICA =====
    const fasesArvore = [
      { dias: 1, nome: "Semente", emoji: "üå±", desc: "A jornada come√ßa com um √∫nico dia de foco. Plante sua semente e cultive sua dedica√ß√£o di√°ria!" },
      { dias: 15, nome: "Broto", emoji: "üåø", desc: "Com 15 dias consecutivos, seu esfor√ßo come√ßa a brotar. Continue regando sua determina√ß√£o!" },
      { dias: 60, nome: "√Årvore", emoji: "üå≥", desc: "60 dias de foco ininterrupto! Sua √°rvore cresce forte, simbolizando sua consist√™ncia e perseveran√ßa." },
      { dias: 180, nome: "Flores", emoji: "üå∏", desc: "180 dias de dedica√ß√£o fazem florescer resultados. Cada flor representa uma conquista em sua jornada!" },
      { dias: 365, nome: "Frutos", emoji: "üçé", desc: "365 dias de foco cont√≠nuo! Colha os frutos do seu trabalho √°rduo e dedica√ß√£o inabal√°vel." }
    ];
    
    let arvoreEpica = {
      consecutivos: 0,
      ultimoDia: null,
      faseAtual: 0
    };
    
    async function verificarArvoreEpica(totalCheckins) {
      const hojeISO = getHojeISO();
      
      // Se j√° processamos hoje, n√£o fazemos nada
      if (arvoreEpica.ultimoDia === hojeISO) {
        return;
      }
      
      // Verifica se atingiu o m√≠nimo
      if (totalCheckins >= 10) {
        const ultimoDia = arvoreEpica.ultimoDia;
        const ontem = new Date();
        ontem.setDate(ontem.getDate() - 1);
        const ontemISO = ontem.toISOString().slice(0,10);
        
        // Se n√£o tem √∫ltimo dia registrado ou se o √∫ltimo dia foi ontem, incrementa
        if (!ultimoDia || ultimoDia === ontemISO) {
          arvoreEpica.consecutivos++;
        } else {
          // Se n√£o for consecutivo, reinicia contagem
          arvoreEpica.consecutivos = 1;
        }
        
        arvoreEpica.ultimoDia = hojeISO;
      } else {
        // Se n√£o atingiu, resetamos a contagem
        arvoreEpica.consecutivos = 0;
        arvoreEpica.ultimoDia = null;
      }
      
      // Atualizar fase atual
      let novaFase = 0;
      for (let i = fasesArvore.length - 1; i >= 0; i--) {
        if (arvoreEpica.consecutivos >= fasesArvore[i].dias) {
          novaFase = i;
          break;
        }
      }
      arvoreEpica.faseAtual = novaFase;
      
      // Salvar no Firestore
      const arvoreRef = doc(db, "arvoreEpica", "progresso");
      await setDoc(arvoreRef, arvoreEpica);
      
      // Atualizar a exibi√ß√£o
      atualizarExibicaoArvore();
      
      // Mostrar notifica√ß√£o se mudou de fase
      if (novaFase > 0 && arvoreEpica.consecutivos === fasesArvore[novaFase].dias) {
        const somConquista = document.getElementById("som-conquista");
        somConquista.currentTime = 0;
        somConquista.play();
        mostrarPopup("üå≥ √Årvore √âpica", `Parab√©ns! A √°rvore evoluiu para: ${fasesArvore[novaFase].nome} ${fasesArvore[novaFase].emoji}`, 5000);
        dispararConfete();
      }
    }
    
    async function carregarArvoreEpica() {
      const arvoreRef = doc(db, "arvoreEpica", "progresso");
      const docSnap = await getDoc(arvoreRef);
      
      if (docSnap.exists()) {
        arvoreEpica = docSnap.data();
      } else {
        // Inicializar com valores padr√£o
        arvoreEpica = {
          consecutivos: 0,
          ultimoDia: null,
          faseAtual: 0
        };
        await setDoc(arvoreRef, arvoreEpica);
      }
      
      atualizarExibicaoArvore();
    }
    
    function atualizarExibicaoArvore() {
      const fase = fasesArvore[arvoreEpica.faseAtual];
      document.getElementById("stage-name").textContent = fase.nome + " " + fase.emoji;
      document.getElementById("stage-desc").textContent = fase.desc;
      document.getElementById("dias-consecutivos").textContent = arvoreEpica.consecutivos;
      
      // Mostrar a imagem da fase atual e esconder as outras
      const imagens = ["seed", "sprout", "tree", "flowers", "fruits"];
      imagens.forEach((img, index) => {
        const el = document.getElementById(img);
        if (index === arvoreEpica.faseAtual) {
          el.style.display = "block";
        } else {
          el.style.display = "none";
        }
      });
      
      // Pr√≥xima fase
      const proximaFase = arvoreEpica.faseAtual < fasesArvore.length - 1 ? fasesArvore[arvoreEpica.faseAtual + 1] : null;
      if (proximaFase) {
        const diasFaltando = proximaFase.dias - arvoreEpica.consecutivos;
        document.getElementById("proxima-fase").textContent = `Faltam ${diasFaltando} dias para ${proximaFase.nome} ${proximaFase.emoji}`;
      } else {
        document.getElementById("proxima-fase").textContent = "Voc√™ alcan√ßou o n√≠vel m√°ximo!";
      }
      
      // Verificar modo noite (ap√≥s 18h)
      const agora = new Date();
      const horas = agora.getHours();
      const modoNoite = horas >= 18 || horas < 6;
      
      // Aplicar modo noite
      const treeSky = document.querySelector(".tree-sky");
      if (modoNoite) {
        treeSky.classList.add("night-mode");
        treeSky.classList.remove("day-mode");
        // Criar estrelas se necess√°rio
        if (document.querySelector('.stars-container').children.length === 0) {
          criarEstrelas();
        }
      } else {
        treeSky.classList.remove("night-mode");
        treeSky.classList.add("day-mode");
      }
    }
    
    function criarEstrelas() {
      const starsContainer = document.querySelector('.stars-container');
      const starCount = 100;
      starsContainer.innerHTML = '';
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        // Tamanho aleat√≥rio
        const size = Math.random() * 3 + 1;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        
        // Posi√ß√£o aleat√≥ria
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        
        // Atraso de anima√ß√£o
        star.style.animationDelay = `${Math.random() * 4}s`;
        
        // Dura√ß√£o da anima√ß√£o
        star.style.animationDuration = `${2 + Math.random() * 3}s`;
        
        starsContainer.appendChild(star);
      }
    }
    
    // ===== FUN√á√ïES PARA VERIFICA√á√ÉO AUTOM√ÅTICA DE MUDAN√áA DE DATA =====
    async function verificarMudancaData() {
      const novaData = getHojeISO();
      if (dataAtual !== novaData) {
        dataAtual = novaData;
        
        // Recarregar dados para o novo dia
        await carregarPresenca();
        
        // Atualizar UI
        await atualizarResumo();
        
        // Atualizar informa√ß√µes de data no cabe√ßalho
        atualizarDataCabecalho();
        atualizarInfoSemana();
        
        // Verificar finaliza√ß√£o da semana
        await finalizarSemana();
        
        // Recarregar √Årvore √âpica
        await carregarArvoreEpica();
      }
    }
    
    // Fun√ß√£o para atualizar o cabe√ßalho com a data
    function atualizarDataCabecalho() {
      const hoje = getHoje();
      const dataHoje = hoje.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
      document.getElementById("dataHoje").textContent = dataHoje.charAt(0).toUpperCase() + dataHoje.slice(1);
    }
    
    // Fun√ß√£o para atualizar informa√ß√µes da semana
    function atualizarInfoSemana() {
      const semanaAtual = getSemanaAtual();
      document.getElementById("info-semana").innerHTML = `
        <div style="font-weight:bold"><span class="destaque-semana">Semana ${semanaAtual.numero}</span></div>
        <div>(${semanaAtual.inicioFormatado} a ${semanaAtual.fimFormatado})</div>
        <div style="font-size:0.9rem;margin-top:5px;color:#7f8c8d">
          A competi√ß√£o ser√° encerrada s√°bado (${semanaAtual.fimCompeticao}), √†s 23:59h.
        </div>
      `;
    }

    window.onload = async () => {
      // Inicializar data atual
      dataAtual = getHojeISO();
      
      await carregarPresenca();
      await carregarTotalDias();
      await carregarPontosSemanais();
      await carregarRankingGeral();
      
      const semanaAtual = getSemanaAtual();
      const semanaDocRef = doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10));
      const semanaDoc = await getDoc(semanaDocRef);
      if (!semanaDoc.exists()) {
        await setDoc(semanaDocRef, {
          abelha: 0,
          joaninha: 0,
          vagalume: 0,
          finalizada: false
        });
      }
      
      const rankingRef = doc(db, "ranking", "geral");
      const rankingDoc = await getDoc(rankingRef);
      if (!rankingDoc.exists()) await setDoc(rankingRef, rankingGeral);
      
      atualizarPlacarSemanal();
      atualizarRankingGeral();
      await finalizarSemana();

      // Tema din√¢mico corrigido
      const hora = new Date().getHours();
      const body = document.body;
      body.classList.remove("tema-manha", "tema-tarde", "tema-noite");
      if (hora >= 5 && hora < 12) body.classList.add("tema-manha");
      else if (hora >= 12 && hora < 18) body.classList.add("tema-tarde");
      else body.classList.add("tema-noite");

      // Atualizar informa√ß√µes de data
      atualizarDataCabecalho();
      atualizarInfoSemana();
      
      // Event listeners
      membros.forEach(nome => {
        document.getElementById(nome).addEventListener("change", () => marcarCheckbox(nome));
      });
      
      // Bot√£o de reset
      const resetBtn = document.createElement('button');
      resetBtn.textContent = '‚öôÔ∏è';
      resetBtn.title = 'Resetar todos os dados (apenas para desenvolvimento)';
      resetBtn.style.position = 'fixed';
      resetBtn.style.bottom = '20px';
      resetBtn.style.right = '20px';
      resetBtn.style.zIndex = '10000';
      resetBtn.style.background = '#e74c3c';
      resetBtn.style.color = 'white';
      resetBtn.style.border = 'none';
      resetBtn.style.borderRadius = '50%';
      resetBtn.style.width = '40px';
      resetBtn.style.height = '40px';
      resetBtn.style.fontSize = '20px';
      resetBtn.style.cursor = 'pointer';
      resetBtn.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
      resetBtn.onclick = resetarTudo;
      document.body.appendChild(resetBtn);

      // Carregar √Årvore √âpica
      await carregarArvoreEpica();
      
      // Atualizar resumo e verificar equipes completas
      await atualizarResumo();
      verificarEquipeCompleta();
      
      // Iniciar verifica√ß√£o peri√≥dica de mudan√ßa de data (a cada 1 minuto)
      setInterval(verificarMudancaData, 60000);
    }
  </script>
  <style>
    /* MODIFICA√á√ïES SOLICITADAS */
    
    /* 1. Adicionar emoji üëë nos l√≠deres */
    .grupo:first-child h2::before {
      content: "üëë ";
    }

    /* 3. Reduzir tamanho do destaque da semana */
    .destaque-semana {
      font-size: 1.5rem;
      font-weight: bold;
      display: inline-block;
      margin: 0 5px;
      color: #e74c3c;
    }
    .tema-tarde .destaque-semana { color: #e67e22; }
    .tema-noite .destaque-semana { color: #9b59b6; }
    
    /* 4. Alinhar pontua√ß√£o √† direita */
    .membro label {
      display: flex;
      justify-content: space-between;
      width: 100%;
      align-items: center;
    }
    .dias-badge {
      margin-left: auto;
      margin-right: 5px;
    }
    
    /* AJUSTES ADICIONAIS PARA MELHOR VISUALIZA√á√ÉO */
    .medalha-container {
      margin-right: 8px;
    }
    
    /* Estilos para cores por equipe */
    #equipe-abelha .membro input:checked + label { color: #FFD700; }
    #equipe-joaninha .membro input:checked + label { color: #FF6B6B; }
    #equipe-vagalume .membro input:checked + label { color: #27ae60; }
    
    .tema-noite #equipe-abelha .membro input:checked + label { color: #FFD700; }
    .tema-noite #equipe-joaninha .membro input:checked + label { color: #FF6B6B; }
    .tema-noite #equipe-vagalume .membro input:checked + label { color: #2ecc71; }
    
    /* Anima√ß√£o de equipe completa personalizada por equipe */
    .equipe-completa.abelha {
      animation: glow-abelha 2s infinite alternate;
    }
    .equipe-completa.joaninha {
      animation: glow-joaninha 2s infinite alternate;
    }
    .equipe-completa.vagalume {
      animation: glow-vagalume 2s infinite alternate;
    }
    
    @keyframes glow-abelha {
      0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.7); }
      100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.9), 0 0 30px rgba(255, 215, 0, 0.7); }
    }
    @keyframes glow-joaninha {
      0% { box-shadow: 0 0 5px rgba(255, 107, 107, 0.7); }
      100% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.9), 0 0 30px rgba(255, 107, 107, 0.7); }
    }
    @keyframes glow-vagalume {
      0% { box-shadow: 0 0 5px rgba(46, 204, 113, 0.7); }
      100% { box-shadow: 0 0 20px rgba(46, 204, 113, 0.9), 0 0 30px rgba(46, 204, 113, 0.7); }
    }
    
    .lider-equipe {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      text-align: center;
      border: 1px dashed rgba(0,0,0,0.1);
    }
    
    .tema-noite .lider-equipe {
      background: rgba(255, 255, 255, 0.1);
      border: 1px dashed rgba(255,255,255,0.1);
    }
    
    .titulo-lider {
      font-weight: bold;
      margin-bottom: 5px;
      color: #7f8c8d;
      text-transform: uppercase;
      font-size: 0.9rem;
    }
    
    .tema-noite .titulo-lider {
      color: #bdc3c7;
    }
    
    .lider-equipe .membro {
      background: rgba(255, 255, 255, 0.3);
      margin-top: 8px;
    }
    
    .tema-noite .lider-equipe .membro {
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* EFEITO NEON PERSONALIZADO POR EQUIPE */
    .equipe-abelha input:checked + label::after {
      animation: glowCheckAbelha 2s infinite alternate;
    }
    @keyframes glowCheckAbelha {
      from { box-shadow: 0 0 5px #FFD700; }
      to { box-shadow: 0 0 15px #FFD700; }
    }

    .equipe-joaninha input:checked + label::after {
      animation: glowCheckJoaninha 2s infinite alternate;
    }
    @keyframes glowCheckJoaninha {
      from { box-shadow: 0 0 5px #FF6B6B; }
      to { box-shadow: 0 0 15px #FF6B6B; }
    }

    .equipe-vagalume input:checked + label::after {
      animation: glowCheckVagalume 2s infinite alternate;
    }
    @keyframes glowCheckVagalume {
      from { box-shadow: 0 0 5px #27ae60; }
      to { box-shadow: 0 0 15px #2ecc71; }
    }

    /* ============ NOVOS ESTILOS SOLICITADOS ============ */
    /* Redu√ß√£o geral de tamanhos para desktop */
    @media (min-width: 769px) {
      /* Reduzir t√≠tulos */
      .competicao-container h2,
      .grupo h2,
      .arvore-epica-container h2,
      .medalha-info h2 {
        font-size: 1.6rem;
      }
      
      /* Reduzir texto explicativo */
      .competicao-container p {
        font-size: 0.85em;
      }
      
      /* Reduzir se√ß√£o √Årvore √âpica */
      .tree-info {
        padding: 15px;
      }
      .stage-info {
        font-size: 1.8rem;
      }
      .stage-desc {
        font-size: 1.1rem;
      }
      .progresso-consecutivo {
        font-size: 1rem;
      }
      
      /* Reduzir se√ß√£o Sistema de Medalhas */
      .medalha-emoji {
        font-size: 2rem;
      }
      .medalha-nome {
        font-size: 0.95rem;
      }
      .medalha-dias {
        font-size: 0.85rem;
      }
      
      /* Reduzir t√≠tulo "L√≠der da Equipe" */
      .titulo-lider {
        font-size: 0.85rem;
      }
    }

    /* Estilos restantes permanecem iguais */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      padding: 20px;
      transition: background-color 0.5s ease;
      min-height: 100vh;
      background: linear-gradient(135deg, #f5f7fa, #e4edf5);
    }
    
    /* TEMA MANH√É */
    .tema-manha { 
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      color: #2c3e50;
    }
    .tema-manha header {
      background: rgba(255, 251, 235, 0.85);
      box-shadow: 0 5px 15px rgba(252, 182, 159, 0.3);
    }
    .tema-manha .global-stats,
    .tema-manha .competicao-container,
    .tema-manha .grupo,
    .tema-manha .medalha-info,
    .tema-manha .arvore-epica-container {
      background: rgba(255, 251, 235, 0.8);
      box-shadow: 0 8px 20px rgba(252, 182, 159, 0.2);
    }
    .tema-manha .equipe-competicao {
      background: rgba(255, 251, 235, 0.95);
      box-shadow: 0 5px 15px rgba(252, 182, 159, 0.2);
    }
    .tema-manha .membro {
      background: rgba(255, 251, 235, 0.7);
    }
    .tema-manha .resumo {
      background: rgba(252, 182, 159, 0.15);
      color: #e74c3c;
    }
    .tema-manha #progresso-barra {
      background: linear-gradient(90deg, #ff9a9e, #fad0c4);
    }
    
    /* TEMA TARDE */
    .tema-tarde { 
      background: linear-gradient(135deg, #f6d365, #fda085);
      color: #2c3e50;
    }
    .tema-tarde header {
      background: rgba(255, 247, 230, 0.85);
      box-shadow: 0 5px 15px rgba(253, 160, 133, 0.3);
    }
    .tema-tarde .global-stats,
    .tema-tarde .competicao-container,
    .tema-tarde .grupo,
    .tema-tarde .medalha-info,
    .tema-tarde .arvore-epica-container {
      background: rgba(255, 247, 230, 0.8);
      box-shadow: 0 8px 20px rgba(253, 160, 133, 0.2);
    }
    .tema-tarde .equipe-competicao {
      background: rgba(255, 247, 230, 0.95);
      box-shadow: 0 5px 15px rgba(253, 160, 133, 0.2);
    }
    .tema-tarde .membro {
      background: rgba(255, 247, 230, 0.7);
    }
    .tema-tarde .resumo {
      background: rgba(253, 160, 133, 0.15);
      color: #e67e22;
    }
    .tema-tarde #progresso-barra {
      background: linear-gradient(90deg, #f6d365, #fda085);
    }
    
    /* TEMA NOITE */
    .tema-noite { 
      background: linear-gradient(135deg, #0c0e30, #2a0845);
      color: #ecf0f1;
    }
    .tema-noite header {
      background: rgba(26, 37, 51, 0.9);
      box-shadow: 0 5px 15px rgba(106, 27, 154, 0.4);
    }
    .tema-noite .global-stats,
    .tema-noite .competicao-container,
    .tema-noite .grupo,
    .tema-noite .medalha-info,
    .tema-noite .arvore-epica-container {
      background: rgba(26, 37, 51, 0.85);
      box-shadow: 0 8px 20px rgba(106, 27, 154, 0.3);
    }
    .tema-noite .equipe-competicao {
      background: rgba(43, 57, 87, 0.9);
      box-shadow: 0 5px 15px rgba(106, 27, 154, 0.3);
    }
    .tema-noite .membro {
      background: rgba(52, 73, 94, 0.7);
    }
    .tema-noite .resumo {
      background: rgba(106, 27, 154, 0.2);
      color: #9b59b6;
    }
    .tema-noite #progresso-barra {
      background: linear-gradient(90deg, #8e2de2, #4a00e0);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 25px;
      padding: 15px;
      border-radius: 15px;
      position: relative;
      background: rgba(255, 255, 255, 0.8);
    }
    .tema-noite header {
      background: rgba(43, 57, 87, 0.8);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 5px;
      color: #2C3E50;
      text-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      z-index: 2;
    }
    .tema-manha h1 { color: #e74c3c; }
    .tema-tarde h1 { color: #e67e22; }
    .tema-noite h1 { 
      color: #9b59b6;
      text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
    }
    
    #dataHoje {
      font-size: 1.2rem;
      margin-bottom: 5px;
      font-weight: 500;
      color: #7f8c8d;
    }
    .tema-noite #dataHoje { color: #bdc3c7; }
    
    #info-semana {
      font-size: 1.1rem;
      margin-bottom: 15px;
      font-weight: 600;
      color: #3498db;
      background: #e1f5fe;
      padding: 10px 15px;
      border-radius: 20px;
      display: inline-block;
      text-align: center;
      line-height: 1.4;
    }
    .tema-noite #info-semana {
      color: #81d4fa;
      background: #0d47a1;
    }
    
    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .global-stats {
      flex: 1;
      min-width: 300px;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .tema-noite .global-stats {
      background: rgba(43, 57, 87, 0.9);
    }
    
    #contadorGeral {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 15px 0;
      color: #2C3E50;
    }
    .tema-noite #contadorGeral { color: #ecf0f1; }
    
    .progresso-container {
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 90%;
      overflow: hidden;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
    }
    
    #progresso-barra {
      height: 100%;
      width: 0%;
      border-radius: 10px;
      transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      overflow: hidden;
    }
    #progresso-barra::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s infinite;
    }
    @keyframes progressShine {
      100% { left: 100%; }
    }
    
    .competicao-container {
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    .tema-noite .competicao-container {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .competicao-container h2 {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
      color: #2C3E50;
    }
    .tema-noite .competicao-container h2 {
      color: #ecf0f1;
      border-bottom: 2px solid #3a506b;
    }
    
    .equipes-competicao {
      display: flex;
      justify-content: space-around;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .equipe-competicao {
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      flex: 1;
      min-width: 120px;
      transition: transform 0.3s ease;
      background: #f8f9fa;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }
    .equipe-competicao:hover { transform: translateY(-5px); }
    .tema-noite .equipe-competicao { background: #3B4C6B; }
    
    .equipe-competicao h3 {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    
    .equipe-competicao .score {
      font-size: 2rem;
      font-weight: bold;
      color: #3498db;
    }
    .tema-noite .equipe-competicao .score { color: #1abc9c; }
    
    .grupos-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .grupo {
      border-radius: 15px;
      padding: 20px;
      transition: transform 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    .grupo:hover { transform: translateY(-5px); }
    .tema-noite .grupo { background: rgba(43, 57, 87, 0.9); }
    
    .grupo h2 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
      color: #2C3E50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .tema-noite .grupo h2 {
      color: #ecf0f1;
      border-bottom: 2px solid #3a506b;
    }
    
    .resumo {
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.1rem;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      background: #f0f7ff;
      color: #3498db;
    }
    .tema-noite .resumo {
      color: #1abc9c;
      background: #1c2e3f;
    }
    
    .membros-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
    }
    
    .membro {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    .membro:hover {
      background: #e9ecef;
      transform: scale(1.03);
    }
    .tema-noite .membro { background: #2c3e50; }
    .tema-noite .membro:hover { background: #34495e; }
    
    .membro input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .membro label {
      cursor: pointer;
      flex: 1;
      font-size: 1rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      position: relative;
    }
    .membro input:checked + label { font-weight: bold; }
    .tema-noite .membro input:checked + label { font-weight: bold; }
    
    .membro input:checked + label::after {
      content: "";
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      border-radius: 8px;
      z-index: -1;
    }
    
    #popup {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s, transform 0.5s;
      z-index: 1000;
      font-size: 1.1rem;
      font-weight: 500;
      text-align: center;
      backdrop-filter: blur(5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      max-width: 90%;
      line-height: 1.5;
    }
    .tema-noite #popup {
      background: linear-gradient(135deg, #8e2de2, #4a00e0);
    }
    #popup.mostrar {
      opacity: 1;
      transform: translateX(-50%) translateY(-10px);
    }
    
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    
    .medalha-info {
      border-radius: 15px;
      padding: 20px;
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .tema-noite .medalha-info {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .medalha-info h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2C3E50;
    }
    .tema-noite .medalha-info h2 { color: #ecf0f1; }
    
    .medalhas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .medalha-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 10px;
      text-align: center;
    }
    .tema-noite .medalha-item { background: #3B4C6B; }
    
    .medalha-emoji {
      font-size: 2.5rem;
      margin-bottom: 8px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }
    
    .medalha-nome {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .medalha-dias {
      font-size: 0.9rem;
      color: #7f8c8d;
    }
    .tema-noite .medalha-dias { color: #bdc3c7; }
    
    .destaque {
      animation: highlight 1s ease;
    }
    @keyframes highlight {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); background: rgba(255, 215, 0, 0.3); }
      100% { transform: scale(1); }
    }
    
    .sem-lider {
      font-style: italic;
      color: #7f8c8d;
      padding: 8px 12px;
      width: 100%;
    }
    .tema-noite .sem-lider { color: #bdc3c7; }
    
    .funcao-lider {
      font-size: 0.8em;
      color: #7f8c8d;
      margin-left: 5px;
      font-style: italic;
    }
    .tema-noite .funcao-lider { color: #bdc3c7; }
    
    /* ===== MELHORIAS SOLICITADAS PARA A √ÅRVORE √âPICA ===== */
    /* Tamanho progressivo das imagens */
    #seed { max-width: 20%; max-height: 30%; }
    #sprout { max-width: 35%; max-height: 45%; }
    #tree { max-width: 55%; max-height: 65%; }
    #flowers { max-width: 75%; max-height: 80%; }
    #fruits { max-width: 90%; max-height: 85%; }
    
    /* Expans√£o da grama para cobrir toda a largura */
    .ground {
      width: 100%;
      max-width: none;
      left: 0;
      border-radius: 0;
    }
    
    .grass-detail {
      width: 100%;
      border-radius: 0;
    }
    
    /* Corre√ß√µes para modo escuro do navegador */
    .sun {
      background: radial-gradient(circle, #ffeb3b, #ffc107) !important;
      filter: none !important;
    }
    
    .moon {
      background: radial-gradient(circle, #e0e0e0, #bdbdbd) !important;
      filter: none !important;
    }
    
    .cloud {
      background: rgba(255, 255, 255, 0.9) !important;
      filter: none !important;
    }
    
    .star {
      background: rgba(255, 255, 255, 0.8) !important;
      filter: none !important;
    }

    /* ===== ESTILOS PARA A √ÅRVORE √âPICA ===== */
    .arvore-epica-container {
      border-radius: 15px;
      padding: 20px;
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .tema-noite .arvore-epica-container {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .arvore-epica-container h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2C3E50;
    }
    
    .tema-noite .arvore-epica-container h2 {
      color: #ecf0f1;
    }
    
    .tree-display {
      position: relative;
      height: 400px;
      margin: 20px auto;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      overflow: hidden;
      background: transparent;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .tree-sky {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      transition: all 1.5s ease;
    }
    
    .tree-sky.day-mode {
      background: linear-gradient(to bottom, #1e88e5, #4da0ff, #a1c9ff);
    }
    
    .tree-sky.night-mode {
      background: linear-gradient(to bottom, #0d47a1, #1a237e, #000051);
    }
    
    .sun {
      position: absolute;
      top: 50px;
      right: 100px;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle, #ffeb3b, #ffc107);
      border-radius: 50%;
      box-shadow: 0 0 40px #ff9800;
      z-index: 2;
      transition: all 2s ease;
    }
    
    .moon {
      position: absolute;
      top: 50px;
      right: 100px;
      width: 55px;
      height: 55px;
      background: radial-gradient(circle, #e0e0e0, #bdbdbd);
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
      z-index: 2;
      opacity: 0;
      transition: all 2s ease;
    }
    
    .night-mode .sun {
      opacity: 0;
    }
    
    .night-mode .moon {
      opacity: 1;
    }
    
    .cloud {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      z-index: 3;
      animation: float-cloud 40s infinite linear;
    }
    
    .cloud-1 {
      top: 80px;
      left: -150px;
      width: 80px;
      height: 30px;
      animation-duration: 50s;
    }
    
    .cloud-2 {
      top: 40px;
      left: -250px;
      width: 120px;
      height: 50px;
      animation-duration: 60s;
      animation-delay: 10s;
    }
    
    .cloud-3 {
      top: 120px;
      left: -200px;
      width: 100px;
      height: 40px;
      animation-duration: 70s;
      animation-delay: 20s;
    }
    
    .night-mode .cloud {
      background: rgba(200, 200, 255, 0.2);
    }
    
    .star {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: twinkle 4s infinite alternate;
      opacity: 0;
      display: none;
    }
    
    .night-mode .star {
      opacity: 1;
      display: block;
    }
    
    .tree-image {
      position: absolute;
      bottom: 0;
      z-index: 10;
      max-height: 85%;
      transform-origin: bottom center;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.4));
      animation: sway 8s infinite ease-in-out;
    }
    
    .ground {
      position: absolute;
      bottom: 0;
      width: 140%;
      max-width: 800px;
      height: 80px;
      background: linear-gradient(to top, #2e7d32 0%, #388e3c 20%, #4caf50 100%);
      border-radius: 50% 50% 0 0;
      z-index: 5;
    }
    
    .night-mode .ground {
      background: linear-gradient(to top, #1b5e20 0%, #2e7d32 20%, #388e3c 100%);
    }
    
    .grass-detail {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 15px;
      background: linear-gradient(to top, rgba(76, 175, 80, 0.8), rgba(56, 142, 60, 0.9));
      border-radius: 50% 50% 0 0;
      z-index: 6;
    }
    
    .night-mode .grass-detail {
      background: linear-gradient(to top, rgba(56, 142, 60, 0.7), rgba(40, 124, 44, 0.8));
    }
    
    .tree-info {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(245, 245, 245, 0.8));
      border-radius: 20px;
      padding: 20px;
      margin: 20px auto;
      max-width: 800px;
      border: 2px solid rgba(0, 180, 216, 0.4);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    
    .tema-noite .tree-info {
      background: linear-gradient(135deg, rgba(13, 27, 42, 0.7), rgba(26, 37, 51, 0.8));
      border: 2px solid rgba(0, 150, 199, 0.3);
    }
    
    .stage-info {
      font-size: 2rem;
      margin-bottom: 10px;
      font-weight: 700;
      color: #00b4d8;
    }
    
    .tema-noite .stage-info {
      color: #90e0ef;
    }
    
    .stage-desc {
      font-size: 1.2rem;
      margin: 15px 0;
      line-height: 1.5;
      color: #2e7d32;
    }
    
    .tema-noite .stage-desc {
      color: #c8e6c9;
    }
    
    .progresso-consecutivo {
      margin-top: 15px;
      font-size: 1.1rem;
      padding: 10px;
      background: rgba(0, 180, 216, 0.1);
      border-radius: 10px;
      color: #0077b6;
    }
    
    .tema-noite .progresso-consecutivo {
      background: rgba(0, 150, 199, 0.15);
      color: #90e0ef;
    }
    
    @keyframes sway {
      0% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
      100% { transform: rotate(-3deg); }
    }
    
    @keyframes float-cloud {
      0% { transform: translateX(-100%); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateX(100vw); opacity: 0; }
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1.1); }
    }
    
    @media (max-width: 768px) {
      .stats-container { flex-direction: column; }
      .grupos-container { grid-template-columns: 1fr; }
      h1 { font-size: 2rem; }
      #contadorGeral { font-size: 1.5rem; }
      .membros-grid { grid-template-columns: 1fr 1fr; }
      .tree-display {
        height: 300px;
      }
      .sun, .moon {
        right: 30px;
        width: 40px;
        height: 40px;
      }
      .stage-info {
        font-size: 1.6rem;
      }
      .stage-desc {
        font-size: 1rem;
      }
    }
    @media (max-width: 480px) {
      body { padding: 15px; }
      #popup { padding: 12px 20px; font-size: 0.95rem; }
      .membros-grid { grid-template-columns: 1fr; }
      .equipes-competicao { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>√âpicos ‰∫ó üå±</h1>
      <div id="dataHoje"></div>
      <div id="info-semana"></div>
    </header>
    
    <div class="stats-container">
      <div class="global-stats">
        <div id="contadorGeral">0 √©picos focaram hoje!</div>
        <div class="progresso-container">
          <div id="progresso-barra"></div>
        </div>
      </div>
    </div>
    
    <div class="competicao-container">
      <h2>üèÜ Competi√ß√£o de Equipes</h2>
      <div class="equipes-competicao">
        <div class="equipe-competicao">
          <h3>üêù Abelha</h3>
          <div class="score" id="ranking-abelha">0</div>
          <div>Vit√≥rias</div>
        </div>
        <div class="equipe-competicao">
          <h3>üêû Joaninha</h3>
          <div class="score" id="ranking-joaninha">0</div>
          <div>Vit√≥rias</div>
        </div>
        <div class="equipe-competicao">
          <h3>üí° Vaga-lume</h3>
          <div class="score" id="ranking-vagalume">0</div>
          <div>Vit√≥rias</div>
        </div>
      </div>
      <p style="margin-top: 15px; font-size: 0.9em; color: #7f8c8d;">
        Competi√ß√£o semanal: Segunda a S√°bado.<br>
        A equipe com mais pontos ao final da competi√ß√£o ganha +1 ponto no ranking de equipes.<br>
        <strong>Em caso de empate, todas as equipes empatadas ganham +1 ponto.</strong>
      </p>
    </div>
    
    <div class="grupos-container">
      <!-- L√≠der Geral -->
      <div class="grupo">
        <h2>L√≠der Geral</h2>
        <div class="membros-grid">
          <!-- Gui (L√≠der Geral) -->
          <div class="membro">
            <input type="checkbox" id="Gui">
            <label for="Gui">
              <span class="medalha-container">
                <span id="medalha-Gui" class="medalha escondido"></span>
              </span>
              Gui
              <span class="funcao-lider">(L√≠der Geral)</span>
              <span id="dias-Gui" class="dias-badge">0</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Equipe Abelha -->
      <div class="grupo" id="equipe-abelha">
        <h2>üêù Equipe Abelha</h2>
        <div class="resumo" id="resumo-abelha">
          <div>0 focaram hoje!</div>
          <div>0 pontos na semana</div>
        </div>
        
        <!-- √Årea do L√≠der da Equipe Abelha -->
        <div class="lider-equipe">
          <div class="titulo-lider">L√≠der da Equipe</div>
          <div class="membro">
            <input type="checkbox" id="Steh">
            <label for="Steh">
              <span class="medalha-container">
                <span id="medalha-Steh" class="medalha escondido"></span>
              </span>
              Steh
              <span id="dias-Steh" class="dias-badge">0</span>
            </label>
          </div>
        </div>
        
        <div class="membros-grid">
          <div class="membro">
            <input type="checkbox" id="Brenda">
            <label for="Brenda">
              <span class="medalha-container">
                <span id="medalha-Brenda" class="medalha escondido"></span>
              </span>
              Brenda
              <span id="dias-Brenda" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Carlos">
            <label for="Carlos">
              <span class="medalha-container">
                <span id="medalha-Carlos" class="medalha escondido"></span>
              </span>
              Carlos
              <span id="dias-Carlos" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Kamila">
            <label for="Kamila">
              <span class="medalha-container">
                <span id="medalha-Kamila" class="medalha escondido"></span>
              </span>
              Kamila
              <span id="dias-Kamila" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Matt">
            <label for="Matt">
              <span class="medalha-container">
                <span id="medalha-Matt" class="medalha escondido"></span>
              </span>
              Matt
              <span id="dias-Matt" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Sarah">
            <label for="Sarah">
              <span class="medalha-container">
                <span id="medalha-Sarah" class="medalha escondido"></span>
              </span>
              Sarah
              <span id="dias-Sarah" class="dias-badge">0</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Equipe Joaninha -->
      <div class="grupo" id="equipe-joaninha">
        <h2>üêû Equipe Joaninha</h2>
        <div class="resumo" id="resumo-joaninha">
          <div>0 focaram hoje!</div>
          <div>0 pontos na semana</div>
        </div>
        
        <!-- √Årea do L√≠der da Equipe Joaninha (vazia) -->
        <div class="lider-equipe">
          <div class="titulo-lider">L√≠der da Equipe</div>
          <div class="sem-lider">Sem l√≠der</div>
        </div>
        
        <div class="membros-grid">
          <div class="membro">
            <input type="checkbox" id="Carla">
            <label for="Carla">
              <span class="medalha-container">
                <span id="medalha-Carla" class="medalha escondido"></span>
              </span>
              Carla
              <span id="dias-Carla" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Clara">
            <label for="Clara">
              <span class="medalha-container">
                <span id="medalha-Clara" class="medalha escondido"></span>
              </span>
              Clara
              <span id="dias-Clara" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Daniel">
            <label for="Daniel">
              <span class="medalha-container">
                <span id="medalha-Daniel" class="medalha escondido"></span>
              </span>
              Daniel
              <span id="dias-Daniel" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Kaii">
            <label for="Kaii">
              <span class="medalha-container">
                <span id="medalha-Kaii" class="medalha escondido"></span>
              </span>
              Kaii
              <span id="dias-Kaii" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Mich">
            <label for="Mich">
              <span class="medalha-container">
                <span id="medalha-Mich" class="medalha escondido"></span>
              </span>
              Mich
              <span id="dias-Mich" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Monalisa">
            <label for="Monalisa">
              <span class="medalha-container">
                <span id="medalha-Monalisa" class="medalha escondido"></span>
              </span>
              Monalisa
              <span id="dias-Monalisa" class="dias-badge">0</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Equipe Vaga-lume -->
      <div class="grupo" id="equipe-vagalume">
        <h2>üí° Equipe Vaga-lume</h2>
        <div class="resumo" id="resumo-vagalume">
          <div>0 focaram hoje!</div>
          <div>0 pontos na semana</div>
        </div>
        
        <!-- √Årea do L√≠der da Equipe Vaga-lume -->
        <div class="lider-equipe">
          <div class="titulo-lider">L√≠der da Equipe</div>
          <div class="membro">
            <input type="checkbox" id="Duda">
            <label for="Duda">
              <span class="medalha-container">
                <span id="medalha-Duda" class="medalha escondido"></span>
              </span>
              Duda
              <span id="dias-Duda" class="dias-badge">0</span>
            </label>
          </div>
        </div>
        
        <div class="membros-grid">
          <div class="membro">
            <input type="checkbox" id="Burigo">
            <label for="Burigo">
              <span class="medalha-container">
                <span id="medalha-Burigo" class="medalha escondido"></span>
              </span>
              Burigo
              <span id="dias-Burigo" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Felipe">
            <label for="Felipe">
              <span class="medalha-container">
                <span id="medalha-Felipe" class="medalha escondido"></span>
              </span>
              Felipe
              <span id="dias-Felipe" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Gabrielle">
            <label for="Gabrielle">
              <span class="medalha-container">
                <span id="medalha-Gabrielle" class="medalha escondido"></span>
              </span>
              Gabrielle
              <span id="dias-Gabrielle" class="dias-badge">0</span>
            </label>
          </div>
          <div class="membro">
            <input type="checkbox" id="Piment√£o">
            <label for="Piment√£o">
              <span class="medalha-container">
                <span id="medalha-Piment√£o" class="medalha escondido"></span>
              </span>
              Piment√£o
              <span id="dias-Piment√£o" class="dias-badge">0</span>
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SE√á√ÉO ATUALIZADA: √Årvore √âpica -->
    <div class="arvore-epica-container">
      <h2>√Årvore √âpica</h2>
      
      <div class="tree-display">
        <div class="tree-sky day-mode">
          <div class="sun"></div>
          <div class="moon"></div>
          <div class="cloud cloud-1"></div>
          <div class="cloud cloud-2"></div>
          <div class="cloud cloud-3"></div>
          <div class="stars-container"></div>
        </div>
        
        <div class="ground">
          <div class="grass-detail"></div>
        </div>
        
        <img id="seed" class="tree-image" src="https://i.ibb.co/7xsw9ZVd/semente.png" alt="Semente">
        <img id="sprout" class="tree-image" src="https://i.ibb.co/WNcWgWgn/broto.png" alt="Broto" style="display: none;">
        <img id="tree" class="tree-image" src="https://i.ibb.co/0jS2220Z/arvore.png" alt="√Årvore" style="display: none;">
        <img id="flowers" class="tree-image" src="https://i.ibb.co/HLyF1wFt/flores.png" alt="Flores" style="display: none;">
        <img id="fruits" class="tree-image" src="https://i.ibb.co/9k6HjBFk/frutos.png" alt="Frutos" style="display: none;">
      </div>
      
      <div class="tree-info">
        <div class="stage-info" id="stage-name">Semente</div>
        <div class="stage-desc" id="stage-desc">A jornada come√ßa com um √∫nico dia de foco. Plante sua semente e cultive sua dedica√ß√£o di√°ria!</div>
        <div class="progresso-consecutivo">
          <strong>Dias consecutivos: <span id="dias-consecutivos">0</span></strong><br>
          <span id="proxima-fase"></span>
        </div>
      </div>
    </div>
    
    <div class="medalha-info">
      <h2>Sistema de Medalhas</h2>
      <div class="medalhas-grid">
        <div class="medalha-item">
          <div class="medalha-emoji">üî•</div>
          <div class="medalha-nome">Fagulha</div>
          <div class="medalha-dias">3 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üëë</div>
          <div class="medalha-nome">Lenda</div>
          <div class="medalha-dias">10 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üåü</div>
          <div class="medalha-nome">Constante</div>
          <div class="medalha-dias">30 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üíé</div>
          <div class="medalha-nome">Diamante</div>
          <div class="medalha-dias">60 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üöÄ</div>
          <div class="medalha-nome">Foguete</div>
          <div class="medalha-dias">120 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üèÜ</div>
          <div class="medalha-nome">Trof√©u</div>
          <div class="medalha-dias">150 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üîÆ</div>
          <div class="medalha-nome">Bola de cristal</div>
          <div class="medalha-dias">240 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üåû</div>
          <div class="medalha-nome">Solar</div>
          <div class="medalha-dias">365 dias</div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="popup"></div>
  <canvas id="confetti-canvas"></canvas>
  
  <!-- Elementos de √°udio -->
  <audio id="som-check" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
  <audio id="som-conquista" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
</body>
  </html>
