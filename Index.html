<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√âpicos ‰∫ó üå±</title>
  <script type="module">
    import { 
  initializeApp 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, doc, setDoc, getDoc, collection, getDocs, 
  updateDoc, deleteDoc, addDoc, serverTimestamp, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoncRn8ikIdij8aXC0OUeqdqnLITrhmPc",
      authDomain: "foco-diario-75630.firebaseapp.com",
      projectId: "foco-diario-75630",
      storageBucket: "foco-diario-75630.appspot.com",
      messagingSenderId: "1040579676771",
      appId: "1:1040579676771:web:ca12f964d8adb3778e4656"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    const muralRef = collection(db, "mural");
  
    // Vari√°veis din√¢micas
    let membros = [];
    let equipes = {
      abelha: [],
      joaninha: [],
      vagalume: []
    };
    let lider = null;
    let lideresEquipes = {
      abelha: null,
      joaninha: null,
      vagalume: null
    };

    const medalhas = {
      3: { emoji: "üî•", nome: "Fagulha" },
      10: { emoji: "üëë", nome: "Lenda" },
      30: { emoji: "üåü", nome: "Constante" },
      60: { emoji: "üíé", nome: "Diamante" },
      120: { emoji: "üöÄ", nome: "Foguete" },
      150: { emoji: "üèÜ", nome: "Trof√©u" },
      240: { emoji: "üîÆ", nome: "Bola de cristal" },
      365: { emoji: "üåû", nome: "Solar" }
    };
    const totalDiasMembros = {};
    const pontosSemanais = { abelha: 0, joaninha: 0, vagalume: 0 };
    const rankingGeral = { abelha: 0, joaninha: 0, vagalume: 0 };
    const historicoAcoes = {};
    
    // Vari√°vel de controle para evitar duplica√ß√£o
    let atualizando = false;
    
    // Vari√°vel para acompanhar a data atual
    let dataAtual = '';
    
    // Sistema de fila para atualiza√ß√µes r√°pidas
    let filaAtualizacao = Promise.resolve();

    // Vari√°veis para o painel secreto
    let diamanteTaps = 0;
    let painelAberto = false;
    
    // Fun√ß√µes din√¢micas para data
    function getHoje() {
      return new Date();
    }
    
    function getHojeISO() {
      return getHoje().toISOString().slice(0, 10);
    }

    function formatarData(date) {
      const dia = String(date.getDate()).padStart(2, '0');
      const mes = String(date.getMonth() + 1).padStart(2, '0');
      const ano = date.getFullYear();
      return `${dia}/${mes}/${ano}`;
    }

    function getSemanaAtual() {
      const data = getHoje();
      const diaSemana = data.getDay() || 7;
      const segunda = new Date(data);
      segunda.setDate(data.getDate() - diaSemana + 1);
      const sabado = new Date(segunda);
      sabado.setDate(segunda.getDate() + 5);
      const dataISO = new Date(data);
      dataISO.setHours(0, 0, 0, 0);
      dataISO.setDate(dataISO.getDate() + 4 - (dataISO.getDay() || 7));
      const anoInicio = new Date(dataISO.getFullYear(), 0, 1);
      const semanaNumero = Math.ceil((((dataISO - anoInicio) / 86400000) + 1) / 7);
      
      return {
        inicio: segunda,
        fim: sabado,
        numero: semanaNumero,
        inicioFormatado: formatarData(segunda),
        fimFormatado: formatarData(sabado),
        fimCompeticao: formatarData(sabado).slice(0, 5)
      };
    }

    // ====== Carregar membros do Firebase ======
    async function carregarMembrosDoFirebase() {
      try {
        const querySnapshot = await getDocs(collection(db, "membros"));
        
        // Limpar estruturas anteriores
        membros = [];
        equipes = { abelha: [], joaninha: [], vagalume: [] };
        lider = null;
        lideresEquipes = { abelha: null, joaninha: null, vagalume: null };

        querySnapshot.forEach((docSnap) => {
          const dados = docSnap.data();
          const nome = dados.nome;
          const equipe = dados.equipe;
          const papel = dados.papel || "";

          // Armazenar como objeto
          const membro = { nome, equipe, papel };

          if (papel === "lider") {
            lider = membro;
          } else if (papel === "lider-equipe") {
            if (equipe in lideresEquipes) {
              lideresEquipes[equipe] = membro;
            }
            if (equipe in equipes) {
              equipes[equipe].push(membro);
            }
          } else {
            membros.push(membro);
            if (equipe in equipes) {
              equipes[equipe].push(membro);
            }
          }
        });
      } catch (error) {
        console.error("Erro ao carregar membros:", error);
        mostrarPopup("‚ùå Erro", "Falha ao carregar membros do Firebase", 5000);
      }
    }

    // ====== Renderizar membros dinamicamente ======
    function renderizarMembrosNaTela() {
      // Renderizar o l√≠der geral
      const liderContainer = document.getElementById("lider");
      if (lider) {
        liderContainer.innerHTML = `
          <div class="membro">
            <input type="checkbox" id="${lider.nome}">
            <label for="${lider.nome}">
              ${lider.nome}
              <span id="dias-${lider.nome}" class="dias-badge">0</span>
              <span class="medalha-container">
                <span id="medalha-${lider.nome}" class="medalha escondido"></span>
              </span>
            </label>
          </div>
        `;
      } else {
        liderContainer.innerHTML = '<div class="sem-lider">Sem l√≠der</div>';
      }

      // Renderizar cada equipe
      for (const [equipeCod, membrosEquipe] of Object.entries(equipes)) {
        const container = document.getElementById(`equipe-${equipeCod}`);
        // Limpar o container
        container.innerHTML = '';
        // Adicionar o t√≠tulo da equipe
        const titulo = document.createElement('h2');
        titulo.textContent = nomeEquipe(equipeCod);
        container.appendChild(titulo);

        // Adicionar o resumo da equipe
        const resumo = document.createElement('div');
        resumo.className = 'resumo';
        resumo.id = `resumo-${equipeCod}`;
        container.appendChild(resumo);

        // Adicionar a √°rea do l√≠der da equipe
        const liderEquipeContainer = document.createElement('div');
        liderEquipeContainer.className = 'lider-equipe';
        const tituloLider = document.createElement('div');
        tituloLider.className = 'titulo-lider';
        tituloLider.textContent = 'L√≠der da Equipe';
        liderEquipeContainer.appendChild(tituloLider);

        const liderEquipe = lideresEquipes[equipeCod];
        if (liderEquipe) {
          const divLider = document.createElement('div');
          divLider.className = 'membro';
          divLider.innerHTML = `
            <input type="checkbox" id="${liderEquipe.nome}">
            <label for="${liderEquipe.nome}">
              ${liderEquipe.nome}
              <span id="dias-${liderEquipe.nome}" class="dias-badge">0</span>
              <span class="medalha-container">
                <span id="medalha-${liderEquipe.nome}" class="medalha escondido"></span>
              </span>
            </label>
          `;
          liderEquipeContainer.appendChild(divLider);
        } else {
          const semLider = document.createElement('div');
          semLider.className = 'sem-lider';
          semLider.textContent = 'Sem l√≠der';
          liderEquipeContainer.appendChild(semLider);
        }
        container.appendChild(liderEquipeContainer);

        // Adicionar os membros da equipe (exceto o l√≠der da equipe)
        membrosEquipe.forEach(membro => {
          // Se for o l√≠der da equipe, n√£o adicionar novamente
          if (liderEquipe && membro.nome === liderEquipe.nome) {
            return;
          }
          const div = document.createElement('div');
          div.className = 'membro';
          div.innerHTML = `
            <input type="checkbox" id="${membro.nome}">
            <label for="${membro.nome}">
              ${membro.nome}
              <span id="dias-${membro.nome}" class="dias-badge">0</span>
              <span class="medalha-container">
                <span id="medalha-${membro.nome}" class="medalha escondido"></span>
              </span>
            </label>
          `;
          container.appendChild(div);
        });
      }
    }

    function nomeEquipe(cod) {
      if (cod === "abelha") return "üêù Equipe Abelha";
      if (cod === "joaninha") return "üêû Equipe Joaninha";
      if (cod === "vagalume") return "üí° Equipe Vaga-lume";
      return cod;
    }

    // ====== FIM DAS NOVAS FUN√á√ïES ======

    async function salvarPresenca() {
      const presencas = {};
      
      // Coletar todos os membros (incluindo l√≠deres)
      const todosMembros = [];
      if (lider) todosMembros.push(lider.nome);
      membros.forEach(m => todosMembros.push(m.nome));
      for (const equipe of Object.values(equipes)) {
        equipe.forEach(m => todosMembros.push(m.nome));
      }
      
      // Remover duplicatas
      const membrosUnicos = [...new Set(todosMembros)].filter(Boolean);
      
      membrosUnicos.forEach(nome => {
        const checkbox = document.getElementById(nome);
        if (checkbox) {
          presencas[nome] = checkbox.checked;
        }
      });
      
      await setDoc(doc(db, "presencas", getHojeISO()), presencas);
    }

    async function carregarPresenca() {
  const hojeISO = getHojeISO();
  
  try {
    const docSnap = await getDoc(doc(db, "presencas", hojeISO));
    
    if (docSnap.exists()) {
      const data = docSnap.data();
      
      // Percorrer todos os checkboxes da p√°gina
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        const nome = checkbox.id;
        if (nome in data) {
          checkbox.checked = data[nome];
          // Atualizar a classe do label
          const label = checkbox.nextElementSibling;
          if (label) {
            if (checkbox.checked) {
              label.classList.add('checked');
            } else {
              label.classList.remove('checked');
            }
          }
        } else {
          checkbox.checked = false;
          const label = checkbox.nextElementSibling;
          if (label) {
            label.classList.remove('checked');
          }
        }
      });
    } else {
      // Se n√£o existir documento para hoje, desmarcar tudo
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        checkbox.checked = false;
        const label = checkbox.nextElementSibling;
        if (label) {
          label.classList.remove('checked');
        }
      });
    }
  } catch (error) {
    console.error("Erro ao carregar presen√ßas:", error);
    mostrarPopup("‚ùå Erro", "Falha ao carregar presen√ßas do dia.", 5000);
  }
}

    async function carregarTotalDias() {
      const querySnapshot = await getDocs(collection(db, "presencas"));
      
      // Obter todos os nomes de membros
      const todosMembros = [];
      if (lider) todosMembros.push(lider.nome);
      membros.forEach(m => todosMembros.push(m.nome));
      for (const equipe of Object.values(equipes)) {
        equipe.forEach(m => todosMembros.push(m.nome));
      }
      const membrosUnicos = [...new Set(todosMembros)].filter(Boolean);
      
      // Inicializar contadores
      membrosUnicos.forEach(nome => {
        totalDiasMembros[nome] = 0;
      });
      
      querySnapshot.forEach(doc => {
        const data = doc.data();
        membrosUnicos.forEach(nome => {
          if (data[nome]) {
            totalDiasMembros[nome]++;
          }
        });
      });
      
      atualizarMedalhas();
    }

    async function carregarPontosSemanais() {
  try {
    const semanaAtual = getSemanaAtual();
    const semanaDoc = await getDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)));
    
    if (semanaDoc.exists()) {
      const data = semanaDoc.data();
      pontosSemanais.abelha = data.abelha || 0;
      pontosSemanais.joaninha = data.joaninha || 0;
      pontosSemanais.vagalume = data.vagalume || 0;
    } else {
      // Se n√£o existir documento para a semana, inicializar com zeros
      pontosSemanais.abelha = 0;
      pontosSemanais.joaninha = 0;
      pontosSemanais.vagalume = 0;
      
      // Criar documento no Firestore
      await setDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)), {
        abelha: 0,
        joaninha: 0,
        vagalume: 0,
        finalizada: false
      });
    }
    
    atualizarPlacarSemanal();
  } catch (error) {
    console.error("Erro ao carregar pontos semanais:", error);
    mostrarPopup("‚ùå Erro", "Falha ao carregar pontos semanais.", 5000);
  }
}

    async function carregarRankingGeral() {
      const rankingDoc = await getDoc(doc(db, "ranking", "geral"));
      if (rankingDoc.exists()) {
        const data = rankingDoc.data();
        rankingGeral.abelha = data.abelha || 0;
        rankingGeral.joaninha = data.joaninha || 0;
        rankingGeral.vagalume = data.vagalume || 0;
      }
      atualizarRankingGeral();
    }

    async function finalizarSemana() {
      const hoje = getHoje();
      if (hoje.getDay() === 0) {
        const semanaAtual = getSemanaAtual();
        const semanaDoc = await getDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)));
        
        if (semanaDoc.exists() && !semanaDoc.data().finalizada) {
          const pontos = semanaDoc.data();
          let vencedora = null;
          let maxPontos = 0;
          const equipesComPontuacao = [];
          
          if (pontos.abelha > maxPontos) {
            maxPontos = pontos.abelha;
            vencedora = "abelha";
          }
          if (pontos.joaninha > maxPontos) {
            maxPontos = pontos.joaninha;
            vencedora = "joaninha";
          }
          if (pontos.vagalume > maxPontos) {
            maxPontos = pontos.vagalume;
            vencedora = "vagalume";
          }
          
          if (pontos.abelha === maxPontos) equipesComPontuacao.push("abelha");
          if (pontos.joaninha === maxPontos) equipesComPontuacao.push("joaninha");
          if (pontos.vagalume === maxPontos) equipesComPontuacao.push("vagalume");
          
          const empate = equipesComPontuacao.length > 1;
          const rankingRef = doc(db, "ranking", "geral");
          
          if (!empate && vencedora) {
            await updateDoc(rankingRef, {
              [vencedora]: rankingGeral[vencedora] + 1
            });
            rankingGeral[vencedora]++;
            atualizarRankingGeral();
            
            const nomesEquipes = {
              abelha: "Abelha",
              joaninha: "Joaninha",
              vagalume: "Vaga-lume"
            };
            
            mostrarPopup("üèÜ Vit√≥ria Semanal", 
              `Equipe ${nomesEquipes[vencedora]} venceu a semana com ${maxPontos} pontos!`, 8000);
          } else if (empate) {
            const atualizacoes = {};
            const equipesEmpatadas = [];
            
            equipesComPontuacao.forEach(equipe => {
              atualizacoes[equipe] = rankingGeral[equipe] + 1;
              rankingGeral[equipe]++;
              equipesEmpatadas.push(equipe);
            });
            
            await updateDoc(rankingRef, atualizacoes);
            atualizarRankingGeral();
            
            const nomesEquipes = equipesEmpatadas.map(eq => {
              const nomes = {
                abelha: "Abelha",
                joaninha: "Joaninha",
                vagalume: "Vaga-lume"
              };
              return nomes[eq];
            }).join(", ");
            
            mostrarPopup("üèÜ Empate Semanal", 
              `As equipes ${nomesEquipes} empataram com ${maxPontos} pontos cada! Todas ganham um ponto no ranking.`, 8000);
          }
          
          await updateDoc(doc(db, "semanas", semanaAtual.inicio.toISOString().slice(0, 10)), {
            finalizada: true,
            vencedora: empate ? null : vencedora
          });

          // Atualizar a semana no placar
          await carregarPontosSemanais();
          atualizarPlacarSemanal();
          atualizarInfoSemana();
          
          // Resetar pontos semanais localmente para a nova semana
          pontosSemanais.abelha = 0;
          pontosSemanais.joaninha = 0;
          pontosSemanais.vagalume = 0;
          
          // Inicializar nova semana no Firestore
          const novaSemanaInicio = new Date(semanaAtual.inicio);
          novaSemanaInicio.setDate(novaSemanaInicio.getDate() + 7);
          const novaSemanaKey = novaSemanaInicio.toISOString().slice(0, 10);
          await setDoc(doc(db, "semanas", novaSemanaKey), {
            abelha: 0,
            joaninha: 0,
            vagalume: 0,
            finalizada: false
          });
        }
      }
    }

    function getMedalha(totalDias) {
      const niveis = Object.keys(medalhas).map(Number).sort((a, b) => b - a);
      for (const nivel of niveis) {
        if (totalDias >= nivel) {
          return medalhas[nivel];
        }
      }
      return null;
    }

    function atualizarMedalhas() {
      // Obter todos os nomes de membros (lider, l√≠deres de equipe e membros comuns)
      const todosMembros = [];
      if (lider) todosMembros.push(lider.nome);
      membros.forEach(m => todosMembros.push(m.nome));
      for (const equipe of Object.values(equipes)) {
        equipe.forEach(m => todosMembros.push(m.nome));
      }
      // Remover duplicatas (caso haja)
      const membrosUnicos = [...new Set(todosMembros)].filter(Boolean);

      membrosUnicos.forEach(nome => {
        const totalDias = totalDiasMembros[nome] || 0;
        const medalhaElement = document.getElementById(`medalha-${nome}`);
        const diasElement = document.getElementById(`dias-${nome}`);
        const medalha = getMedalha(totalDias);
        
        if (diasElement) diasElement.textContent = `${totalDias}`;
        if (diasElement) diasElement.title = `${totalDias} dias de foco`;
        
        if (medalhaElement) {
          if (medalha) {
            medalhaElement.innerHTML = medalha.emoji;
            medalhaElement.title = `${medalha.nome} - ${totalDias} dias de foco`;
            medalhaElement.classList.add('com-medalha');
            medalhaElement.classList.remove('escondido');
          } else {
            medalhaElement.innerHTML = '';
            medalhaElement.classList.remove('com-medalha');
            medalhaElement.classList.add('escondido');
          }
        }
      });
    }

    function atualizarPlacarSemanal() {
      if (equipes.abelha.length > 0) {
        const focadosAbelha = document.querySelectorAll('#equipe-abelha input:checked').length;
        document.getElementById("resumo-abelha").innerHTML = `
          <div>${focadosAbelha} focaram hoje!</div>
          <div>${pontosSemanais.abelha} pontos na semana</div>
        `;
      }
      
      if (equipes.joaninha.length > 0) {
        const focadosJoaninha = document.querySelectorAll('#equipe-joaninha input:checked').length;
        document.getElementById("resumo-joaninha").innerHTML = `
          <div>${focadosJoaninha} focaram hoje!</div>
          <div>${pontosSemanais.joaninha} pontos na semana</div>
        `;
      }
      
      if (equipes.vagalume.length > 0) {
        const focadosVagalume = document.querySelectorAll('#equipe-vagalume input:checked').length;
        document.getElementById("resumo-vagalume").innerHTML = `
          <div>${focadosVagalume} focaram hoje!</div>
          <div>${pontosSemanais.vagalume} pontos na semana</div>
        `;
      }
    }

    function atualizarRankingGeral() {
      document.getElementById("ranking-abelha").textContent = rankingGeral.abelha;
      document.getElementById("ranking-joaninha").textContent = rankingGeral.joaninha;
      document.getElementById("ranking-vagalume").textContent = rankingGeral.vagalume;
    }

    window.atualizarResumo = async function () {
      // Usar sistema de fila para evitar conflitos
      filaAtualizacao = filaAtualizacao.then(async () => {
        const hoje = getHoje();

        // Obter estado atual do Firestore
        const hojeISO = getHojeISO();
        const docSnap = await getDoc(doc(db, "presencas", hojeISO));
        const estadoFirestore = docSnap.exists() ? docSnap.data() : {};

        // Calcular diferen√ßas baseadas no Firestore
        const diferencas = { abelha: 0, joaninha: 0, vagalume: 0 };
        
        for (const [equipe, membrosEquipe] of Object.entries(equipes)) {
          membrosEquipe.forEach(membro => {
            const estadoAtual = document.getElementById(membro.nome)?.checked || false;
            const estadoSalvo = estadoFirestore[membro.nome] || false;
            
            if (estadoAtual !== estadoSalvo) {
              if (estadoAtual) {
                diferencas[equipe]++;
              } else {
                diferencas[equipe]--;
              }
            }
          });
        }

        // Salvar estado atual no Firestore
        await salvarPresenca();
        
        // Atualizar pontos semanais apenas se n√£o for domingo
        if (hoje.getDay() !== 0) {
          for (const equipe of Object.keys(equipes)) {
            pontosSemanais[equipe] = Math.max(0, pontosSemanais[equipe] + diferencas[equipe]);
          }

          // Atualizar semana no Firestore
          const semanaAtual = getSemanaAtual();
          const semanaKey = semanaAtual.inicio.toISOString().slice(0, 10);
          const semanaRef = doc(db, "semanas", semanaKey);
          
          // Usar setDoc com merge para criar ou atualizar
          await setDoc(semanaRef, pontosSemanais, { merge: true });
        } else {
          // Domingo: n√£o acumula pontos, mant√©m 0
          pontosSemanais.abelha = 0;
          pontosSemanais.joaninha = 0;
          pontosSemanais.vagalume = 0;
        }
        
        // Atualizar UI
        const todosMembros = [];
        if (lider) todosMembros.push(lider.nome);
        membros.forEach(m => todosMembros.push(m.nome));
        for (const equipe of Object.values(equipes)) {
          equipe.forEach(m => todosMembros.push(m.nome));
        }
        const membrosUnicos = [...new Set(todosMembros)].filter(Boolean);
        
        const total = membrosUnicos.filter(nome => {
          const checkbox = document.getElementById(nome);
          return checkbox && checkbox.checked;
        }).length;
        
        document.getElementById("contadorGeral").textContent = `${total} √©picos focaram hoje!`;
        const porcentagem = (total / membrosUnicos.length) * 100;
        document.getElementById("progresso-barra").style.width = `${porcentagem}%`;
        
        // VERIFICA√á√ÉO DA √ÅRVORE √âPICA
        await verificarArvoreEpica(total);
        
        atualizarPlacarSemanal();
        verificarEquipeCompleta();
      });
      
      await filaAtualizacao;
    }

    // Verificar se todos os membros de uma equipe est√£o focados
    function verificarEquipeCompleta() {
      for (const equipeCod in equipes) {
        const membrosEquipe = equipes[equipeCod].map(m => m.nome);
        const todosFocados = membrosEquipe.every(nome => {
          const checkbox = document.getElementById(nome);
          return checkbox && checkbox.checked;
        });
        
        const grupo = document.getElementById(`equipe-${equipeCod}`);
        if (grupo) {
          if (todosFocados) {
            grupo.classList.add('equipe-completa', equipeCod);
          } else {
            grupo.classList.remove('equipe-completa', equipeCod);
          }
        }
      }
    }

    window.mostrarPopup = function (titulo, mensagem, duracao = 8000) {
      const popup = document.getElementById("popup");
      popup.innerHTML = `<strong>${titulo}</strong><br>${mensagem}`;
      popup.classList.add("mostrar");
      popup.style.zIndex = "1001";
      clearTimeout(window.popupTimeout);
      window.popupTimeout = setTimeout(() => {
        popup.classList.remove("mostrar");
        setTimeout(() => popup.style.zIndex = "1000", 500);
      }, duracao);
    }

    const conquistas = {
      5: "üèÜ 5 dias consecutivos!",
      10: "üî• Fogo Sagrado! 10 dias!",
      15: "üöÄ N√≠vel √âpico! 15 dias!"
    };

    const medalhasConcedidas = {};
    
    async function verificarConquista(nome, acao) {
      if (!historicoAcoes[nome]) historicoAcoes[nome] = [];
      historicoAcoes[nome].push({ data: new Date(), acao: acao });
      
      // Atualizar contagem local de dias
      if (acao === 'adicionar') {
        totalDiasMembros[nome] = (totalDiasMembros[nome] || 0) + 1;
      } else if (acao === 'remover') {
        totalDiasMembros[nome] = Math.max(0, (totalDiasMembros[nome] || 0) - 1);
      }
      
      atualizarMedalhas();
      
      const docRef = doc(db, "streak", nome);
      const docSnap = await getDoc(docRef);
      let streak = docSnap.exists() ? docSnap.data().streak : 0;
      
      if (acao === 'adicionar') {
        streak += 1;
      } else if (acao === 'remover') {
        streak = Math.max(0, streak - 1);
      }
      
      await setDoc(docRef, { 
        streak: streak,
        ultimoDia: acao === 'adicionar' ? getHojeISO() : (docSnap.exists() ? docSnap.data().ultimoDia : null)
      });

      const medalha = getMedalha(totalDiasMembros[nome]);
      if (acao === 'adicionar' && medalha) {
        const niveis = Object.keys(medalhas).map(Number);
        const nivelAtual = niveis.find(nivel => nivel === totalDiasMembros[nome]);
        if (nivelAtual && (!medalhasConcedidas[nome] || medalhasConcedidas[nome].nome !== medalha.nome)) {
          medalhasConcedidas[nome] = medalha;
          const somConquista = document.getElementById("som-conquista");
          somConquista.currentTime = 0;
          somConquista.play();
          mostrarPopup("üèÖ Nova Medalha", `${nome} conquistou:<br>${medalha.emoji} ${medalha.nome}!`, 8000);
          dispararConfete();
        }
      }
      else if (acao === 'remover' && medalhasConcedidas[nome]) {
        const medalhaAtual = getMedalha(totalDiasMembros[nome]);
        if (!medalhaAtual || medalhaAtual.nome !== medalhasConcedidas[nome].nome) {
          mostrarPopup("‚ÑπÔ∏è Medalha Removida", `${nome} perdeu a medalha:<br>${medalhasConcedidas[nome].emoji} ${medalhasConcedidas[nome].nome}`, 5000);
          delete medalhasConcedidas[nome];
        }
      }
      
      if (conquistas[streak] && acao === 'adicionar') {
        const somConquista = document.getElementById("som-conquista");
        somConquista.currentTime = 0;
        somConquista.play();
        mostrarPopup("üåü Conquista", `${nome} conquistou:<br>${conquistas[streak]}`, 8000);
        dispararConfete();
      }
    }

    function dispararConfete() {
      const confettiCanvas = document.getElementById("confetti-canvas");
      const confettiCtx = confettiCanvas.getContext('2d');
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      const confettiParticles = [];
      
      // Reduzir n√∫mero de part√≠culas e aumentar velocidade
      for (let i = 0; i < 100; i++) {
        confettiParticles.push({
          x: Math.random() * confettiCanvas.width,
          y: -10,
          size: Math.random() * 10 + 5,
          speed: Math.random() * 8 + 5, // Aumento de velocidade
          color: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'][Math.floor(Math.random() * 5)],
          angle: Math.random() * Math.PI * 2,
          spin: Math.random() * 0.2 - 0.1
        });
      }
      
      function animateConfetti() {
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        let particlesAlive = 0;
        for (let i = 0; i < confettiParticles.length; i++) {
          const p = confettiParticles[i];
          // Aumentar gravidade para cair mais r√°pido
          p.y += p.speed * 0.8;
          p.x += Math.sin(p.angle) * 2;
          p.angle += p.spin;

          // Verificar se a part√≠cula ainda est√° vis√≠vel
          const isVisible = p.y < confettiCanvas.height && 
                           p.x > -50 && 
                           p.x < confettiCanvas.width + 50;
          
          if (isVisible) {
            confettiCtx.fillStyle = p.color;
            confettiCtx.beginPath();
            confettiCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            confettiCtx.fill();
            particlesAlive++;
          }
        }
        
        if (particlesAlive > 0) {
          requestAnimationFrame(animateConfetti);
        } else {
          // Limpar completamente quando todas as part√≠culas sa√≠rem
          confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }
      }
      animateConfetti();
    }

    window.marcarCheckbox = function (nome) {
      const hoje = getHoje();
      if (hoje.getDay() === 0) {
        mostrarPopup("‚ÑπÔ∏è Domingo", "Pontos semanais n√£o s√£o contabilizados aos domingos", 3000);
      }
      
      const checkbox = document.getElementById(nome);
      if (!checkbox) return;
      
      const som = document.getElementById("som-check");
      som.currentTime = 0;
      som.play();
      const label = checkbox.nextElementSibling;
      if (checkbox.checked) label.classList.add('checked');
      else label.classList.remove('checked');
      const acao = checkbox.checked ? 'adicionar' : 'remover';
      verificarConquista(nome, acao);
      atualizarResumo();
      if (checkbox.checked) mostrarPopup("üéâ Foco Registrado", `${nome}, parab√©ns por ter focado hoje!`, 3000);
      else mostrarPopup("‚ÑπÔ∏è Foco Removido", `${nome}, seu foco de hoje foi removido`, 3000);

      // Adicionar destaque apenas no resumo da equipe do membro (exceto l√≠der geral)
      if (lider && nome !== lider.nome) {
        let equipe = "";
        if (equipes.abelha.some(m => m.nome === nome)) equipe = "abelha";
        else if (equipes.joaninha.some(m => m.nome === nome)) equipe = "joaninha";
        else if (equipes.vagalume.some(m => m.nome === nome)) equipe = "vagalume";
        
        if (equipe) {
          const resumo = document.getElementById(`resumo-${equipe}`);
          resumo.classList.add('destaque');
          setTimeout(() => resumo.classList.remove('destaque'), 500);
        }
      }
    }
    
    window.resetarTudo = async function() {
      if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Voc√™ est√° prestes a resetar TODOS os dados!\nIsso apagar√° todo o hist√≥rico e pontos.\n\nDeseja continuar?')) return;
      try {
        // Resetar dados no Firebase
        const presencasSnapshot = await getDocs(collection(db, "presencas"));
        for (const doc of presencasSnapshot.docs) await deleteDoc(doc.ref);
        const semanasSnapshot = await getDocs(collection(db, "semanas"));
        for (const doc of semanasSnapshot.docs) await deleteDoc(doc.ref);
        const streaksSnapshot = await getDocs(collection(db, "streak"));
        for (const doc of streaksSnapshot.docs) await deleteDoc(doc.ref);
        const rankingRef = doc(db, "ranking", "geral");
        await setDoc(rankingRef, { abelha: 0, joaninha: 0, vagalume: 0 });
        
        // Resetar √Årvore √âpica
        const arvoreRef = doc(db, "arvoreEpica", "progresso");
        await deleteDoc(arvoreRef);
        
        // Resetar vari√°veis locais
        pontosSemanais.abelha = 0;
        pontosSemanais.joaninha = 0;
        pontosSemanais.vagalume = 0;
        location.reload();
        mostrarPopup("‚úÖ Reset Completo", "Todos os dados foram resetados com sucesso!", 5000);
      } catch (error) {
        console.error("Erro ao resetar dados:", error);
        mostrarPopup("‚ùå Erro no Reset", "Ocorreu um erro ao tentar resetar os dados.", 5000);
      }
    }

    // ===== NOVAS FUN√á√ïES PARA A √ÅRVORE √âPICA =====
    const fasesArvore = [
      { dias: 1, nome: "Semente", emoji: "üå±", desc: "A jornada come√ßa com um √∫nico dia de foco. Vamos plantar nossa semente e cultivar a nossa dedica√ß√£o di√°ria!" },
      { dias: 15, nome: "Broto", emoji: "üåø", desc: "Com 15 dias consecutivos, nosso esfor√ßo come√ßa a brotar. Vamos continuar regando nossa determina√ß√£o!" },
      { dias: 60, nome: "√Årvore", emoji: "üå≥", desc: "60 dias de foco ininterrupto! Nossa √°rvore cresce forte, simbolizando nossa consist√™ncia e perseveran√ßa." },
      { dias: 180, nome: "Flores", emoji: "üå∏", desc: "180 dias de dedica√ß√£o fazem florescer resultados. Cada flor representa uma conquista em nossa jornada!" },
      { dias: 365, nome: "Frutos", emoji: "üçé", desc: "365 dias de foco cont√≠nuo! Enfim, colhemos os frutos do nosso trabalho √°rduo e dedica√ß√£o inabal√°vel." }
    ];
    
    let arvoreEpica = {
      consecutivos: 0,
      ultimoDia: null,
      faseAtual: 0
    };
    
    async function carregarEstadoArvore() {
      const arvoreRef = doc(db, "arvoreEpica", "progresso");
      const docSnap = await getDoc(arvoreRef);
      
      if (docSnap.exists()) {
        arvoreEpica = docSnap.data();
      } else {
        arvoreEpica = {
          consecutivos: 0,
          ultimoDia: null,
          faseAtual: 0
        };
        await setDoc(arvoreRef, arvoreEpica);
      }
    }
    
    async function verificarArvoreEpica(totalCheckins) {
      const hojeISO = getHojeISO();
      
      // Carregar estado atual da √°rvore
      await carregarEstadoArvore();
      
      // Se o dia atual j√° foi processado (j√° contamos) e agora o total de checkins caiu abaixo de 10, revertemos.
      if (arvoreEpica.ultimoDia === hojeISO) {
        if (totalCheckins < 10) {
          // Revertemos o processamento do dia atual
          arvoreEpica.consecutivos = Math.max(0, arvoreEpica.consecutivos - 1);
          arvoreEpica.ultimoDia = null;
        }
      } 
      // Se o dia atual n√£o foi processado e temos 10 ou mais checkins, processamos.
      else if (totalCheckins >= 10) {
        const ontem = new Date(getHoje());
        ontem.setDate(ontem.getDate() - 1);
        const ontemISO = ontem.toISOString().slice(0,10);
        
        if (!arvoreEpica.ultimoDia || arvoreEpica.ultimoDia === ontemISO) {
          arvoreEpica.consecutivos++;
        } else {
          arvoreEpica.consecutivos = 1;
        }
        arvoreEpica.ultimoDia = hojeISO;
      }
      // Se o dia atual n√£o foi processado e temos menos de 10, n√£o fazemos nada (n√£o conta e n√£o quebra a sequ√™ncia, mas tamb√©m n√£o avan√ßa)
      
      // Atualizar fase atual
      let novaFase = 0;
      for (let i = fasesArvore.length - 1; i >= 0; i--) {
        if (arvoreEpica.consecutivos >= fasesArvore[i].dias) {
          novaFase = i;
          break;
        }
      }
      arvoreEpica.faseAtual = novaFase;
      
      // Salvar no Firestore
      const arvoreRef = doc(db, "arvoreEpica", "progresso");
      await setDoc(arvoreRef, arvoreEpica);
      
      // Atualizar a exibi√ß√£o
      atualizarExibicaoArvore();
      
      // Mostrar notifica√ß√£o se mudou de fase
      if (novaFase > 0 && arvoreEpica.consecutivos === fasesArvore[novaFase].dias) {
        const somConquista = document.getElementById("som-conquista");
        somConquista.currentTime = 0;
        somConquista.play();
        mostrarPopup("üå≥ √Årvore √âpica", `Parab√©ns! A √°rvore evoluiu para: ${fasesArvore[novaFase].nome} ${fasesArvore[novaFase].emoji}`, 5000);
        dispararConfete();
      }
    }
    
    async function carregarArvoreEpica() {
      await carregarEstadoArvore();
      atualizarExibicaoArvore();
    }
    
    function criarEstrelas() {
      const starsContainer = document.querySelector('.stars-container');
      const starCount = 150;
      starsContainer.innerHTML = '';
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        // Tamanho aleat√≥rio
        const size = Math.random() * 3 + 1;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        
        // Posi√ß√£o aleat√≥ria
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        
        // Atraso de anima√ß√£o
        star.style.animationDelay = `${Math.random() * 4}s`;
        
        // Dura√ß√£o da anima√ß√£o
        star.style.animationDuration = `${2 + Math.random() * 3}s`;
        
        starsContainer.appendChild(star);
      }
    }
    
    function atualizarExibicaoArvore() {
      const fase = fasesArvore[arvoreEpica.faseAtual];
      document.getElementById("stage-name").textContent = fase.nome + " " + fase.emoji;
      document.getElementById("stage-desc").textContent = fase.desc;
      document.getElementById("dias-consecutivos").textContent = arvoreEpica.consecutivos;
      
      // Mostrar a imagem da fase atual e esconder as outras
      const imagens = ["seed", "sprout", "tree", "flowers", "fruits"];
      imagens.forEach((img, index) => {
        const el = document.getElementById(img);
        if (index === arvoreEpica.faseAtual) {
          el.style.display = "block";
        } else {
          el.style.display = "none";
        }
      });
      
      // Pr√≥xima fase
      const proximaFase = arvoreEpica.faseAtual < fasesArvore.length - 1 ? fasesArvore[arvoreEpica.faseAtual + 1] : null;
      if (proximaFase) {
        const diasFaltando = proximaFase.dias - arvoreEpica.consecutivos;
        document.getElementById("proxima-fase").textContent = `Faltam ${diasFaltando} dias para ${proximaFase.nome} ${proximaFase.emoji}`;
      } else {
        document.getElementById("proxima-fase").textContent = "Voc√™ alcan√ßou o n√≠vel m√°ximo!";
      }
      
      // Verificar modo noite (ap√≥s 18h)
      const agora = getHoje();
      const horas = agora.getHours();
      const modoNoite = horas >= 18 || horas < 6;
      
      // Aplicar modo noite
      const treeSky = document.querySelector(".tree-sky");
      if (modoNoite) {
        treeSky.classList.add("night-mode");
        treeSky.classList.remove("day-mode");
        // Criar estrelas se necess√°rio
        if (document.querySelector('.stars-container').children.length === 0) {
          criarEstrelas();
        }
        document.querySelector('.stars-container').style.opacity = "1";
      } else {
        treeSky.classList.remove("night-mode");
        treeSky.classList.add("day-mode");
        document.querySelector('.stars-container').style.opacity = "0";
      }
      
      // Controle de visibilidade sol/lua
      document.getElementById("lua").style.opacity = modoNoite ? "1" : "0";
      document.getElementById("sol").style.opacity = modoNoite ? "0" : "1";
    }
    
    // ===== FUN√á√ÉO CORRIGIDA PARA MUDAN√áA DE DATA =====
    async function verificarMudancaData() {
  const novaData = getHojeISO();
  
  if (dataAtual !== novaData) {
    console.log(`Mudan√ßa de data detectada: ${dataAtual} -> ${novaData}`);
    
    try {
      // 1. Atualizar data atual
      dataAtual = novaData;
      
      // 2. Carregar dados do Firestore
      await carregarPresenca();
      await carregarPontosSemanais();
      
      // 3. Atualizar UI
      atualizarPlacarSemanal();
      atualizarDataCabecalho();
      atualizarInfoSemana();
      verificarEquipeCompleta();
      
      // 4. Atualizar √Årvore √âpica
      await carregarArvoreEpica();

      // 5. Salvar no localStorage
      localStorage.setItem('ultimoDiaProcessado', novaData);
      
      console.log(`Sistema reinicializado para o novo dia: ${getHojeISO()}`);
    } catch (error) {
      console.error("Erro ao verificar mudan√ßa de data:", error);
      mostrarPopup("‚ùå Erro", "Falha ao atualizar para o novo dia.", 5000);
    }
  }
}

    // ===== NOVA FUN√á√ÉO PARA RECARREGAR √Ä MEIA-NOITE =====
    function iniciarTimerMeiaNoite() {
      const agora = getHoje();
      const meiaNoite = new Date(agora);
      meiaNoite.setHours(24, 0, 0, 0);
      
      const tempoRestante = meiaNoite - agora;
      
      setTimeout(() => {
        location.reload(); // Recarrega a p√°gina para garantir reset completo
      }, tempoRestante);
    }

   
    // Fun√ß√£o para atualizar o cabe√ßalho com a data
    function atualizarDataCabecalho() {
      const hoje = getHoje();
      const dataHoje = hoje.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
      document.getElementById("dataHoje").textContent = dataHoje.charAt(0).toUpperCase() + dataHoje.slice(1);
    }
    
    // Fun√ß√£o para atualizar informa√ß√µes da semana
    function atualizarInfoSemana() {
      const semanaAtual = getSemanaAtual();
      document.getElementById("info-semana").innerHTML = `
        <div style="font-weight:bold"><span class="destaque-semana">Semana ${semanaAtual.numero}</span></div>
        <div>(${semanaAtual.inicioFormatado} a ${semanaAtual.fimFormatado})</div>
        <div style="font-size:0.9rem;margin-top:5px;color:#7f8c8d">
          A competi√ß√£o ser√° encerrada s√°bado (${semanaAtual.fimCompeticao}), √†s 23:59h.
        </div>
      `;
    }

    // Fun√ß√£o para verificar toques na medalha de Diamante
    function verificarToqueDiamante(event) {
      if (event.target.textContent.includes('üíé') && !painelAberto) {
        diamanteTaps++;
        if (diamanteTaps >= 5) {
          const senha = prompt("üîê Digite a senha secreta:");
          if (senha === "goiaba") {
            abrirPainelSecreto();
          } else {
            alert("‚ùå Senha incorreta!");
          }
          diamanteTaps = 0;
        }
      }
    }

function abrirPainelSecreto() {
  painelAberto = true;
  const painel = document.getElementById('painel-secreto');
  painel.style.display = 'block';
  
  // Preencher select de membros
  const selectMembro = document.getElementById('membro-pontos');
  selectMembro.innerHTML = '';
  
  // Obter todos os membros
  const todosMembros = [];
  if (lider) todosMembros.push(lider.nome);
  membros.forEach(m => todosMembros.push(m.nome));
  for (const equipe of Object.values(equipes)) {
    equipe.forEach(m => todosMembros.push(m.nome));
  }
  const membrosUnicos = [...new Set(todosMembros)].filter(Boolean);
  
  membrosUnicos.forEach(membro => {
    const option = document.createElement('option');
    option.value = membro;
    option.textContent = membro;
    selectMembro.appendChild(option);
  });
 
}

    // Fun√ß√µes do painel secreto
    window.ajustarPontosMembro = async function () {
  const membro = document.getElementById('membro-pontos').value.trim();
  const quantidade = parseInt(document.getElementById('quantidade-membro').value);

  if (!membro || isNaN(quantidade)) return;

  const hoje = new Date();

  for (let i = 0; i < Math.abs(quantidade); i++) {
    const data = new Date(hoje);
    data.setDate(data.getDate() - i - 1); // dias anteriores
    const dataISO = data.toISOString().slice(0, 10);

    const docRef = doc(db, "presencas", dataISO);
    const docSnap = await getDoc(docRef);
    let dados = docSnap.exists() ? docSnap.data() : {};

    if (quantidade > 0) {
      dados[membro] = true;
    } else {
      dados[membro] = false;
    }

    await setDoc(docRef, dados, { merge: true });
  }

  await carregarTotalDias(); // Atualiza contadores
  atualizarMedalhas();        // Atualiza medalhas
  atualizarResumo();          // Atualiza visuais

  mostrarPopup(`‚úÖ ${quantidade > 0 ? 'Adicionados' : 'Removidos'} ${Math.abs(quantidade)} dia(s) para ${membro}!`);
};

    window.ajustarPontosEquipe = async function() {
      const equipe = document.getElementById('equipe-pontos').value;
      const quantidade = parseInt(document.getElementById('quantidade-equipe').value);
      
      pontosSemanais[equipe] += quantidade;
      if (pontosSemanais[equipe] < 0) pontosSemanais[equipe] = 0;
      
      // Atualizar Firestore
      const semanaAtual = getSemanaAtual();
      const semanaKey = semanaAtual.inicio.toISOString().slice(0, 10);
      const semanaRef = doc(db, "semanas", semanaKey);
      await setDoc(semanaRef, pontosSemanais, { merge: true });
      
      atualizarPlacarSemanal();
      mostrarPopup(`‚úÖ ${quantidade > 0 ? 'Adicionados' : 'Removidos'} ${Math.abs(quantidade)} pontos para ${equipe}`, 3000);
    };

    window.ajustarPontosRanking = async function() {
      const equipe = document.getElementById('equipe-ranking').value;
      const quantidade = parseInt(document.getElementById('quantidade-ranking').value);
      
      rankingGeral[equipe] += quantidade;
      if (rankingGeral[equipe] < 0) rankingGeral[equipe] = 0;
      
      // Atualizar Firestore
      const rankingRef = doc(db, "ranking", "geral");
      await setDoc(rankingRef, rankingGeral, { merge: true });
      
      atualizarRankingGeral();
      mostrarPopup(`‚úÖ ${quantidade > 0 ? 'Adicionados' : 'Removidos'} ${Math.abs(quantidade)} vit√≥rias para ${equipe}`, 3000);
    };

// Fun√ß√£o para enviar mensagem
window.enviarMensagem = async function() {
  const nomeInput = document.getElementById('mensagem-nome');
  const textoInput = document.getElementById('mensagem-texto');
  const anonimaCheck = document.getElementById('mensagem-anonima');
  
  const nome = anonimaCheck.checked ? "An√¥nimo" : (nomeInput.value.trim() || "Membro √âpico");
  const texto = textoInput.value.trim();
  
  if (!texto) {
    mostrarPopup("‚ùå Campo vazio", "Por favor, escreva sua mensagem antes de enviar.", 3000);
    return;
  }

  try {
    await addDoc(muralRef, {
      nome: nome,
      texto: texto,
      timestamp: serverTimestamp()
    });
    
    // Limpar campos
    textoInput.value = '';
    nomeInput.value = '';
    anonimaCheck.checked = false;
    
    mostrarPopup("üíå Mensagem enviada", "Sua mensagem foi publicada no mural!", 3000);
    
    const somEnvio = document.getElementById("som-check");
    somEnvio.currentTime = 0;
    somEnvio.play();
  } catch (error) {
    console.error("Erro ao enviar mensagem:", error);
    mostrarPopup("‚ùå Erro", "Falha ao enviar a mensagem. Tente novamente.", 5000);
  }
};

// Fun√ß√£o para carregar e exibir mensagens
function carregarMural() {
  const muralContainer = document.getElementById('mural-mensagens');
  
  onSnapshot(muralRef, (snapshot) => {
    muralContainer.innerHTML = '';
    
    const mensagens = [];
    snapshot.forEach(doc => {
      mensagens.push({ id: doc.id, ...doc.data() });
    });
    
    // Ordenar por timestamp (mais recente primeiro)
    mensagens.sort((a, b) => {
      const aTime = a.timestamp?.toDate?.() || new Date(0);
      const bTime = b.timestamp?.toDate?.() || new Date(0);
      return bTime - aTime;
    });

    if (mensagens.length === 0) {
      muralContainer.innerHTML = `
        <div class="mensagem-item" style="text-align: center; grid-column: 1 / -1;">
          <div class="mensagem-texto">
            O mural est√° vazio... Seja o primeiro a compartilhar!
          </div>
          <div class="mensagem-info">
            <span class="mensagem-autor">Equipe √âpicos</span>
            <span class="mensagem-hora">Agora</span>
          </div>
        </div>
      `;
      return;
    }

    mensagens.forEach(msg => {
      const timestamp = msg.timestamp?.toDate?.() || new Date();
      const hora = timestamp.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      const data = timestamp.toLocaleDateString('pt-BR');
      
      const mensagemEl = document.createElement('div');
      mensagemEl.className = 'mensagem-item';
      mensagemEl.dataset.id = msg.id;
      
      mensagemEl.innerHTML = `
        <div class="mensagem-texto">${msg.texto}</div>
        <div class="mensagem-info">
          <span class="mensagem-autor">${msg.nome}</span>
          <span class="mensagem-hora">${hora} - ${data}</span>
        </div>
        <div class="mensagem-delete" onclick="excluirMensagem('${msg.id}')">‚ùå</div>
      `;
      
      muralContainer.appendChild(mensagemEl);
    });
  });
}

// Fun√ß√£o para excluir mensagem
window.excluirMensagem = async function(id) {
  if (!confirm('Tem certeza que deseja excluir esta mensagem?')) return;
  
  try {
    await deleteDoc(doc(db, "mural", id));
    mostrarPopup("üóëÔ∏è Mensagem exclu√≠da", "A mensagem foi removida do mural.", 3000);
  } catch (error) {
    console.error("Erro ao excluir mensagem:", error);
    mostrarPopup("‚ùå Erro", "Falha ao excluir a mensagem.", 3000);
  }
};

// Fun√ß√£o para adicionar rea√ß√£o
window.adicionarReacao = function(id, emoji) {
  const mensagemEl = document.querySelector(`.mensagem-item[data-id="${id}"]`);
  if (!mensagemEl) return;
  
  const btn = mensagemEl.querySelector(`.reacao-btn:nth-child(${emoji === 'üëç' ? 1 : emoji === '‚ù§Ô∏è' ? 2 : 3})`);
  if (!btn) return;
  
  // Simular adi√ß√£o de rea√ß√£o
  const texto = btn.textContent;
  const regex = /(\d+)/;
  const match = texto.match(regex);
  const count = match ? parseInt(match[0]) + 1 : 1;
  
  btn.textContent = `${emoji} ${count}`;
  btn.style.animation = "pulse 0.5s";
  setTimeout(() => btn.style.animation = "", 500);
  
  // Tocar som de rea√ß√£o
  const somReacao = document.getElementById("som-conquista");
  somReacao.currentTime = 0;
  somReacao.play();
};
  
    window.onload = async () => {
  // Primeiro, espere o DOM estar completamente carregado
  await new Promise(resolve => setTimeout(resolve, 100));
  
  try {
    // 1. Carregar membros primeiro
    await carregarMembrosDoFirebase();
    renderizarMembrosNaTela();
    
    // 2. Carregar dados do Firestore
    await Promise.all([
      carregarPresenca(),
      carregarPontosSemanais(),
      carregarRankingGeral(),
      carregarTotalDias(),
      carregarArvoreEpica()
    ]);
    
    // 3. Configurar eventos e UI
    atualizarDataCabecalho();
    atualizarInfoSemana();
    verificarEquipeCompleta();
    atualizarResumo();
    
    // 4. Iniciar mural (remova a mensagem de exemplo est√°tica)
    document.getElementById("mural-mensagens").innerHTML = '';
    carregarMural();
    
    // 5. Configurar tema
    const hora = new Date().getHours();
    const body = document.body;
    body.classList.remove("tema-manha", "tema-tarde", "tema-noite");
    if (hora >= 5 && hora < 12) body.classList.add("tema-manha");
    else if (hora >= 12 && hora < 18) body.classList.add("tema-tarde");
    else body.classList.add("tema-noite");
    
    // 6. Configurar eventos
    document.addEventListener('click', verificarToqueDiamante);
    iniciarTimerMeiaNoite();
    setInterval(verificarMudancaData, 30000);
    
  } catch (error) {
    console.error("Erro durante o carregamento:", error);
    mostrarPopup("‚ùå Erro", "Falha ao carregar os dados. Recarregue a p√°gina.", 5000);
  }
};
      
    async function carregarMensagensParaPainel() {
  const select = document.getElementById('mensagem-excluir');
  select.innerHTML = '';
  
  const querySnapshot = await getDocs(muralRef);
  querySnapshot.forEach(doc => {
    const msg = doc.data();
    const option = document.createElement('option');
    option.value = doc.id;
    option.textContent = `${msg.nome}: ${msg.texto.slice(0, 30)}...`;
    select.appendChild(option);
  });
}

window.excluirMensagemSelecionada = async function() {
  const select = document.getElementById('mensagem-excluir');
  const id = select.value;
  
  if (!id) return;
  
  if (confirm('Tem certeza que deseja excluir esta mensagem?')) {
    await deleteDoc(doc(db, "mural", id));
    mostrarPopup("üóëÔ∏è Mensagem Exclu√≠da", "A mensagem foi removida com sucesso.", 3000);
    await carregarMensagensParaPainel();
  }
}

window.excluirTodasMensagens = async function() {
  if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso excluir√° TODAS as mensagens. Continuar?')) {
    const querySnapshot = await getDocs(muralRef);
    const promises = [];
    
    querySnapshot.forEach(doc => {
      promises.push(deleteDoc(doc.ref));
    });
    
    await Promise.all(promises);
    mostrarPopup("üóëÔ∏è Mural Limpo", "Todas as mensagens foram exclu√≠das.", 5000);
    await carregarMensagensParaPainel();
  
    await carregarMural();
    
    await verificarLimpezaMuralSemanal();
    
  }
};
  
  // Fun√ß√£o para limpar o mural na segunda-feira
async function verificarLimpezaMuralSemanal() {
  const hoje = getHoje();
  if (hoje.getDay() === 1) { // Segunda-feira
    const ultimaLimpeza = localStorage.getItem('ultimaLimpezaMural');
    const hojeISO = getHojeISO();
    
    if (ultimaLimpeza !== hojeISO) {
      // Verificar se j√° h√° mensagens no mural
      const querySnapshot = await getDocs(muralRef);
      if (!querySnapshot.empty) {
        if (confirm('Deseja limpar o mural de mensagens nesta segunda-feira?')) {
          await excluirTodasMensagens();
          localStorage.setItem('ultimaLimpezaMural', hojeISO);
          mostrarPopup("ü™ß Mural Limpo", "Todas as mensagens foram removidas (limpeza semanal).", 5000);
        }
      }
    }
  }
}
  
  </script>
  <style>
    /* MODIFICA√á√ïES SOLICITADAS */
    
    /* 1. Adicionar emoji üëë nos l√≠deres */
    .grupo:first-child h2::before {
      content: "üëë ";
    }

    /* 3. Reduzir tamanho do destaque da semana */
    .destaque-semana {
      font-size: 1.5rem;
      font-weight: bold;
      display: inline-block;
      margin: 0 5px;
      color: #e74c3c;
    }
    .tema-tarde .destaque-semana { color: #e67e22; }
    .tema-noite .destaque-semana { color: #9b59b6; }
    
    /* 4. Alinhar pontua√ß√£o √† direita */
    .membro label {
      display: flex;
      justify-content: space-between;
      width: 100%;
      align-items: center;
    }
    .dias-badge {
      margin-left: auto;
      margin-right: 5px;
    }
    
    /* AJUSTES ADICIONAIS PARA MELHOR VISUALIZA√á√ÉO */
    .medalha-container {
      margin-left: 8px; /* Alterado para aparecer depois do nome */
    }
    
    /* Estilos para cores por equipe */
    #equipe-abelha .membro input:checked + label { color: #FFD700; }
    #equipe-joaninha .membro input:checked + label { color: #FF6B6B; }
    #equipe-vagalume .membro input:checked + label { color: #27ae60; }
    
    .tema-noite #equipe-abelha .membro input:checked + label { color: #FFD700; }
    .tema-noite #equipe-joaninha .membro input:checked + label { color: #FF6B6B; }
    .tema-noite #equipe-vagalume .membro input:checked + label { color: #2ecc71; }
    
    /* Anima√ß√£o de equipe completa personalizada por equipe */
    .equipe-completa.abelha {
      animation: glow-abelha 2s infinite alternate;
    }
    .equipe-completa.joaninha {
      animation: glow-joaninha 2s infinite alternate;
    }
    .equipe-completa.vagalume {
      animation: glow-vagalume 2s infinite alternate;
    }
    
    @keyframes glow-abelha {
      0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.7); }
      100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.9), 0 0 30px rgba(255, 215, 0, 0.7); }
    }
    @keyframes glow-joaninha {
      0% { box-shadow: 0 0 5px rgba(255, 107, 107, 0.7); }
      100% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.9), 0 0 30px rgba(255, 107, 107, 0.7); }
    }
    @keyframes glow-vagalume {
      0% { box-shadow: 0 0 5px rgba(46, 204, 113, 0.7); }
      100% { box-shadow: 0 0 20px rgba(46, 204, 113, 0.9), 0 0 30px rgba(46, 204, 113, 0.7); }
    }
    
    .lider-equipe {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      text-align: center;
      border: 1px dashed rgba(0,0,0,0.1);
    }
    
    .tema-noite .lider-equipe {
      background: rgba(255, 255, 255, 0.1);
      border: 1px dashed rgba(255,255,255,0.1);
    }
    
    .titulo-lider {
      font-weight: bold;
      margin-bottom: 5px;
      color: #7f8c8d;
      text-transform: uppercase;
      font-size: 0.9rem;
    }
    
    .tema-noite .titulo-lider {
      color: #bdc3c7;
    }
    
    .lider-equipe .membro {
      background: rgba(255, 255, 255, 0.3);
      margin-top: 8px;
    }
    
    .tema-noite .lider-equipe .membro {
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* EFEITO NEON PERSONALIZADO POR EQUIPE */
    .equipe-abelha input:checked + label::after {
      animation: glowCheckAbelha 2s infinite alternate;
    }
    @keyframes glowCheckAbelha {
      from { box-shadow: 0 0 5px #FFD700; }
      to { box-shadow: 0 0 15px #FFD700; }
    }

    .equipe-joaninha input:checked + label::after {
      animation: glowCheckJoaninha 2s infinite alternate;
    }
    @keyframes glowCheckJoaninha {
      from { box-shadow: 0 0 5px #FF6B6B; }
      to { box-shadow: 0 0 15px #FF6B6B; }
    }

    .equipe-vagalume input:checked + label::after {
      animation: glowCheckVagalume 2s infinite alternate;
    }
    @keyframes glowCheckVagalume {
      from { box-shadow: 0 0 5px #27ae60; }
      to { box-shadow: 0 0 15px #2ecc71; }
    }

    /* ============ NOVOS ESTILOS SOLICITADOS ============ */
    /* Redu√ß√£o geral de tamanhos para desktop */
    @media (min-width: 769px) {
      /* Reduzir t√≠tulos */
      .competicao-container h2,
      .grupo h2,
      .arvore-epica-container h2,
      .medalha-info h2 {
        font-size: 1.6rem;
      }
      
      /* Reduzir texto explicativo */
      .competicao-container p {
        font-size: 0.85em;
      }
      
      /* Reduzir se√ß√£o Sistema de Medalhas */
      .medalha-emoji {
        font-size: 2rem;
      }
      .medalha-nome {
        font-size: 0.95rem;
      }
      .medalha-dias {
        font-size: 0.85rem;
      }
      
      /* Reduzir t√≠tulo "L√≠der da Equipe" */
      .titulo-lider {
        font-size: 0.85rem;
      }
    }

    /* ===== MELHORIAS PARA A √ÅRVORE √âPICA ===== */
    .arvore-epica-container {
      border-radius: 15px;
      padding: 20px;
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .tema-noite .arvore-epica-container {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .arvore-epica-container h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2C3E50;
    }
    
    .tema-noite .arvore-epica-container h2 {
      color: #ecf0f1;
    }
    
    .tree-display {
      position: relative;
      height: 400px; 
      margin: 20px auto;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      overflow: hidden;
      background: transparent;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.7);
    }
    
    .tree-sky {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      transition: all 1.5s ease;
    }
    
    .tree-sky.day-mode {
      background: url('https://i.ibb.co/35cdphm4/ceu-dia.png');
      background-size: cover;
      background-position: center;
    }
    
    .tree-sky.night-mode {
      background: url('https://i.ibb.co/BHNXckSp/ceu-noite.png');
      background-size: cover;
      background-position: center;
    }
    
    .sky-object, .nuvem, .ground, .tree-image {
      position: absolute;
    }
    
    /* Sol com efeito de pulsa√ß√£o */
    #sol {
      top: 15px; /* posi√ß√£o mais alta */
      right: 40px; /* mais centralizado */
      width: 50px; /* anterior: 40px */
      height: 50px; /* anterior: 40px */
      z-index: 2;
      transition: opacity 1.5s ease;
      opacity: 1;
      animation: pulsate 3s infinite alternate;
    }
    
    /* Lua sem efeito de pulsa√ß√£o */
    #lua {
      top: 15px; /* posi√ß√£o mais alta */
      right: 40px; /* mais centralizado */
      width: 50px; /* anterior: 40px */
      height: 50px; /* anterior: 40px */
      z-index: 2;
      transition: opacity 1.5s ease;
      opacity: 0;
    }
    
    #sol img, #lua img {
      width: 100%;
      height: 100%;
    }
    
    @keyframes pulsate {
      0% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }
    
    /* Nuvens com in√≠cio imediato e posi√ß√µes iniciais variadas */
    .nuvem {
      width: 56px; /* anterior: 80px */
      height: auto;
      z-index: 2;
      opacity: 0.7;
      filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.2));
      animation: float-cloud 60s infinite linear;
    }
    
    /* Tamanhos espec√≠ficos reduzidos */
    .nuvem-1 {
      top: 15%;
      left: -20%;
      width: 42px; /* anterior: 60px */
      animation-duration: 80s;
    }
    
    .nuvem-2 {
      top: 30%;
      left: -20%;
      width: 70px; /* anterior: 100px */
      animation-duration: 70s;
    }
    
    .nuvem-3 {
      top: 45%;
      left: -20%;
      width: 56px; /* anterior: 80px */
      animation-duration: 90s;
    }
    
    /* Novas nuvens - posicionadas mais acima */
    .nuvem-4 {
      top: 20%;
      left: -20%;
      width: 49px; /* anterior: 70px */
      animation-duration: 75s;
      animation-delay: 15s;
    }
    
    .nuvem-5 {
      top: 35%;
      left: -20%;
      width: 63px; /* anterior: 90px */
      animation-duration: 85s;
      animation-delay: 30s;
    }
    
    .nuvem-6 {
      top: 50%;
      left: -20%;
      width: 77px; /* anterior: 110px */
      animation-duration: 95s;
      animation-delay: 45s;
    }
    
    /* Anima√ß√£o com movimento cont√≠nuo */
    @keyframes float-cloud {
      0% { 
        transform: translateX(0);
        opacity: 0;
      }
      1% {
        opacity: 0.7;
      }
      100% { 
        transform: translateX(calc(100vw + 150px));
        opacity: 0.7; 
      }
    }
    
    /* Grama mais verde e lisa */
    .ground {
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      z-index: 5;
      background: linear-gradient(to top, 
        #1b5e20, 
        #2e7d32, 
        #4caf50);
      box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
    }
    
    /* √Årvore sobre a grama - posicionamento mais baixo */
    .tree-image {
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 6;
      animation: sway 8s infinite ease-in-out;
      transform-origin: bottom center;
      transition: transform 0.5s ease, max-height 0.5s ease;
      max-height: 75%;
    }
    
    /* Ajustes de tamanho para as fases da √°rvore */
    #seed { max-width: 20%; max-height: 40%; }
    #sprout { max-width: 35%; max-height: 50%; }
    #tree { max-width: 60%; max-height: 65%; }
    #flowers { 
      max-width: 95%; 
      max-height: 85%;
      bottom: 65px;
    }
    #fruits { 
      max-width: 100%; 
      max-height: 90%;
      bottom: 60px;
    }
    
    /* Anima√ß√£o especial para fases maiores */
    #flowers, #fruits {
      animation: sway-large 10s infinite ease-in-out;
    }
    
    @keyframes sway {
      0% { transform: translateX(-50%) rotate(-3deg); }
      50% { transform: translateX(-50%) rotate(3deg); }
      100% { transform: translateX(-50%) rotate(-3deg); }
    }
    
    @keyframes sway-large {
      0% { transform: translateX(-50%) rotate(-2deg); }
      50% { transform: translateX(-50%) rotate(2deg); }
      100% { transform: translateX(-50%) rotate(-2deg); }
    }
    
    .tree-info {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(200, 230, 201, 0.15));
      border-radius: 20px;
      padding: 25px;
      margin: 25px auto;
      max-width: 800px;
      border: 2px solid rgba(0, 180, 216, 0.4);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      text-align: center;
    }
    
    .stage-info {
      font-size: 2.5rem;
      margin-bottom: 15px;
      font-weight: 700;
      color: #00b4d8;
      text-shadow: 0 0 15px rgba(0, 180, 216, 0.7);
    }
    
    .stage-desc {
      font-size: 1.3rem;
      margin: 20px 0;
      line-height: 1.6;
      color: #2c3e50; /* CONTRASTE MELHORADO */
      font-weight: 500; /* ADICIONADO */
    }
    
    .tema-noite .stage-desc {
      color: #ecf0f1; /* CONTRASTE MELHORADO PARA MODO NOITE */
    }
    
    .progresso-consecutivo {
      margin-top: 20px;
      font-size: 1.2rem;
      padding: 15px;
      background: rgba(0, 180, 216, 0.25); /* CONTRASTE MELHORADO */
      border-radius: 15px;
      color: #005a6e; /* CONTRASTE MELHORADO */
      font-weight: 600; /* ADICIONADO */
      border: 1px solid rgba(0, 180, 216, 0.3);
    }

    .tema-noite .progresso-consecutivo {
      color: #80deea; /* CONTRASTE MELHORADO PARA MODO NOITE */
    }

    /* Criar estrelas para o modo noturno */
    .stars-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      transition: opacity 1s ease;
    }
    
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite alternate;
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1.1); }
    }

    /* ===== ESTILOS RESTANTES ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      padding: 20px;
      transition: background-color 0.5s ease;
      min-height: 100vh;
      background: linear-gradient(135deg, #f5f7fa, #e4edf5);
    }
    
    /* TEMA MANH√É */
    .tema-manha { 
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      color: #2c3e50;
    }
    .tema-manha header {
      background: rgba(255, 251, 235, 0.85);
      box-shadow: 0 5px 15px rgba(252, 182, 159, 0.3);
    }
    .tema-manha .global-stats,
    .tema-manha .competicao-container,
    .tema-manha .grupo,
    .tema-manha .medalha-info,
    .tema-manha .arvore-epica-container {
      background: rgba(255, 251, 235, 0.8);
      box-shadow: 0 8px 20px rgba(252, 182, 159, 0.2);
    }
    .tema-manha .equipe-competicao {
      background: rgba(255, 251, 235, 0.95);
      box-shadow: 0 5px 15px rgba(252, 182, 159, 0.2);
    }
    .tema-manha .membro {
      background: rgba(255, 251, 235, 0.7);
    }
    .tema-manha .resumo {
      background: rgba(252, 182, 159, 0.15);
      color: #e74c3c;
    }
    .tema-manha #progresso-barra {
      background: linear-gradient(90deg, #ff9a9e, #fad0c4);
    }
    
    /* TEMA TARDE */
    .tema-tarde { 
      background: linear-gradient(135deg, #f6d365, #fda085);
      color: #2c3e50;
    }
    .tema-tarde header {
      background: rgba(255, 247, 230, 0.85);
      box-shadow: 0 5px 15px rgba(253, 160, 133, 0.3);
    }
    .tema-tarde .global-stats,
    .tema-tarde .competicao-container,
    .tema-tarde .grupo,
    .tema-tarde .medalha-info,
    .tema-tarde .arvore-epica-container {
      background: rgba(255, 247, 230, 0.8);
      box-shadow: 0 8px 20px rgba(253, 160, 133, 0.2);
    }
    .tema-tarde .equipe-competicao {
      background: rgba(255, 247, 230, 0.95);
      box-shadow: 0 5px 15px rgba(253, 160, 133, 0.2);
    }
    .tema-tarde .membro {
      background: rgba(255, 247, 230, 0.7);
    }
    .tema-tarde .resumo {
      background: rgba(253, 160, 133, 0.15);
      color: #e67e22;
    }
    .tema-tarde #progresso-barra {
      background: linear-gradient(90deg, #f6d365, #fda085);
    }
    
    /* TEMA NOITE */
    .tema-noite { 
      background: linear-gradient(135deg, #0c0e30, #2a0845);
      color: #ecf0f1;
    }
    .tema-noite header {
      background: rgba(26, 37, 51, 0.9);
      box-shadow: 0 5px 15px rgba(106, 27, 154, 0.4);
    }
    .tema-noite .global-stats,
    .tema-noite .competicao-container,
    .tema-noite .grupo,
    .tema-noite .medalha-info,
    .tema-noite .arvore-epica-container {
      background: rgba(26, 37, 51, 0.85);
      box-shadow: 0 8px 20px rgba(106, 27, 154, 0.3);
    }
    .tema-noite .equipe-competicao {
      background: rgba(43, 57, 87, 0.9);
      box-shadow: 0 5px 15px rgba(106, 27, 154, 0.3);
    }
    .tema-noite .membro {
      background: rgba(52, 73, 94, 0.7);
    }
    .tema-noite .resumo {
      background: rgba(106, 27, 154, 0.2);
      color: #9b59b6;
    }
    .tema-noite #progresso-barra {
      background: linear-gradient(90deg, #8e2de2, #4a00e0);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 25px;
      padding: 15px;
      border-radius: 15px;
      position: relative;
      background: rgba(255, 255, 255, 0.8);
    }
    .tema-noite header {
      background: rgba(43, 57, 87, 0.8);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 5px;
      color: #2C3E50;
      text-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      z-index: 2;
    }
    .tema-manha h1 { color: #e74c3c; }
    .tema-tarde h1 { color: #e67e22; }
    .tema-noite h1 { 
      color: #9b59b6;
      text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
    }
    
    #dataHoje {
      font-size: 1.2rem;
      margin-bottom: 5px;
      font-weight: 500;
      color: #7f8c8d;
    }
    .tema-noite #dataHoje { color: #bdc3c7; }
    
    #info-semana {
      font-size: 1.1rem;
      margin-bottom: 15px;
      font-weight: 600;
      color: #3498db;
      background: #e1f5fe;
      padding: 10px 15px;
      border-radius: 20px;
      display: inline-block;
      text-align: center;
      line-height: 1.4;
    }
    .tema-noite #info-semana {
      color: #81d4fa;
      background: #0d47a1;
    }
    
    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .global-stats {
      flex: 1;
      min-width: 300px;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .tema-noite .global-stats {
      background: rgba(43, 57, 87, 0.9);
    }
    
    #contadorGeral {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 15px 0;
      color: #2C3E50;
    }
    .tema-noite #contadorGeral { color: #ecf0f1; }
    
    .progresso-container {
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 90%;
      overflow: hidden;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
    }
    
    #progresso-barra {
      height: 100%;
      width: 0%;
      border-radius: 10px;
      transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      overflow: hidden;
    }
    #progresso-barra::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s infinite;
    }
    @keyframes progressShine {
      100% { left: 100%; }
    }
    
    .competicao-container {
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    .tema-noite .competicao-container {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .competicao-container h2 {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
      color: #2C3E50;
    }
    .tema-noite .competicao-container h2 {
      color: #ecf0f1;
      border-bottom: 2px solid #3a506b;
    }
    
    .equipes-competicao {
      display: flex;
      justify-content: space-around;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .equipe-competicao {
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      flex: 1;
      min-width: 120px;
      transition: transform 0.3s ease;
      background: #f8f9fa;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }
    .equipe-competicao:hover { transform: translateY(-5px); }
    .tema-noite .equipe-competicao { background: #3B4C6B; }
    
    .equipe-competicao h3 {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    
    .equipe-competicao .score {
      font-size: 2rem;
      font-weight: bold;
      color: #3498db;
    }
    .tema-noite .equipe-competicao .score { color: #1abc9c; }
    
    .grupos-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .grupo {
      border-radius: 15px;
      padding: 20px;
      transition: transform 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    .grupo:hover { transform: translateY(-5px); }
    .tema-noite .grupo { background: rgba(43, 57, 87, 0.9); }
    
    .grupo h2 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
      color: #2C3E50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .tema-noite .grupo h2 {
      color: #ecf0f1;
      border-bottom: 2px solid #3a506b;
    }
    
    .resumo {
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.1rem;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      background: #f0f7ff;
      color: #3498db;
    }
    .tema-noite .resumo {
      color: #1abc9c;
      background: #1c2e3f;
    }
    
    .membros-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
    }
    
    .membro {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    .membro:hover {
      background: #e9ecef;
      transform: scale(1.03);
    }
    .tema-noite .membro { background: #2c3e50; }
    .tema-noite .membro:hover { background: #34495e; }
    
    .membro input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .membro label {
      cursor: pointer;
      flex: 1;
      font-size: 1rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      position: relative;
    }
    .membro input:checked + label { font-weight: bold; }
    .tema-noite .membro input:checked + label { font-weight: bold; }
    
    .membro input:checked + label::after {
      content: "";
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      border-radius: 8px;
      z-index: -1;
    }
    
    #popup {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s, transform 0.5s;
      z-index: 1000;
      font-size: 1.1rem;
      font-weight: 500;
      text-align: center;
      backdrop-filter: blur(5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      max-width: 90%;
      line-height: 1.5;
    }
    .tema-noite #popup {
      background: linear-gradient(135deg, #8e2de2, #4a00e0);
    }
    #popup.mostrar {
      opacity: 1;
      transform: translateX(-50%) translateY(-10px);
    }
    
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    
    .medalha-info {
      border-radius: 15px;
      padding: 20px;
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .tema-noite .medalha-info {
      background: rgba(43, 57, 87, 0.9);
    }
    
    .medalha-info h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2C3E50;
    }
    .tema-noite .medalha-info h2 { color: #ecf0f1; }
    
    .medalhas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .medalha-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 10px;
      text-align: center;
    }
    .tema-noite .medalha-item { background: #3B4C6B; }
    
    .medalha-emoji {
      font-size: 2.5rem;
      margin-bottom: 8px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }
    
    .medalha-nome {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .medalha-dias {
      font-size: 0.9rem;
      color: #7f8c8d;
    }
    .tema-noite .medalha-dias { color: #bdc3c7; }
    
    .destaque {
      animation: highlight 1s ease;
    }
    @keyframes highlight {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); background: rgba(255, 215, 0, 0.3); }
      100% { transform: scale(1); }
    }
    
    .sem-lider {
      font-style: italic;
      color: #7f8c8d;
      padding: 8px 12px;
      width: 100%;
    }
    .tema-noite .sem-lider { color: #bdc3c7; }
    
    /* EFEITO NEON PERSONALIZADO POR EQUIPE */
    .equipe-abelha input:checked + label::after {
      animation: glowCheckAbelha 2s infinite alternate;
    }
    @keyframes glowCheckAbelha {
      from { box-shadow: 0 0 5px #FFD700; }
      to { box-shadow: 0 0 15px #FFD700; }
    }

    .equipe-joaninha input:checked + label::after {
      animation: glowCheckJoaninha 2s infinite alternate;
    }
    @keyframes glowCheckJoaninha {
      from { box-shadow: 0 0 5px #FF6B6B; }
      to { box-shadow: 0 0 15px #FF6B6B; }
    }

    .equipe-vagalume input:checked + label::after {
      animation: glowCheckVagalume 2s infinite alternate;
    }
    @keyframes glowCheckVagalume {
      from { box-shadow: 0 0 5px #27ae60; }
      to { box-shadow: 0 0 15px #2ecc71; }
    }

    /* Estilo para o painel secreto */
    #painel-secreto {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(43, 57, 87, 0.95);
      padding: 25px;
      border-radius: 15px;
      z-index: 2000;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      border: 3px solid #00f2fe;
      max-width: 90%;
      width: 500px;
      color: white;
    }
    
    .painel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #00f2fe;
      padding-bottom: 10px;
    }
    
    .painel-secao {
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    
    .painel-controles {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .painel-controles select, 
    .painel-controles input {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: #2c3e50;
      color: white;
      flex: 1;
      min-width: 120px;
    }
    
    .painel-controles button {
      background: #00f2fe;
      color: #0c0e30;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      flex: 1;
    }
    
    .painel-controles button:hover {
      background: #4facfe;
      transform: translateY(-2px);
    }
    
    .btn-fechar {
      background: #e74c3c !important;
      color: white !important;
    }
    
    @media (max-width: 768px) {
      .stats-container { flex-direction: column; }
      .grupos-container { grid-template-columns: 1fr; }
      h1 { font-size: 2rem; }
      #contadorGeral { font-size: 1.5rem; }
      .membros-grid { grid-template-columns: 1fr 1fr; }
      
      /* Responsividade para √Årvore √âpica */
      .tree-display {
        height: 300px !important;
      }
      
      .tree-image {
        max-height: 70% !important;
        bottom: 60px !important;
      }
      
      #sol, #lua {
        width: 38px; /* anterior: 30px */
        height: 38px; /* anterior: 30px */
        top: 12px; /* anterior: 15px */
        right: 30px; /* anterior: 30px */
      }
      
      .nuvem {
        width: 40px !important; /* anterior: 50px */
      }
      
      .arvore-epica-container {
        padding: 15px;
        margin-top: 20px;
      }
      
      .tree-info {
        padding: 15px;
        margin: 15px 0;
      }
      
      .stage-info {
        font-size: 1.8rem !important;
      }
      
      .stage-desc {
        font-size: 1rem !important;
      }
    }
    
    @media (max-width: 480px) {
      body { padding: 15px; }
      #popup { padding: 12px 20px; font-size: 0.95rem; }
      .membros-grid { grid-template-columns: 1fr; }
      .equipes-competicao { flex-direction: column; }
      
      /* Responsividade para √Årvore √âpica */
      .tree-display {
        height: 250px !important;
      }
      
      .tree-image {
        max-height: 65% !important;
        bottom: 50px !important;
      }
      
      #sol, #lua {
        width: 31px !important; /* anterior: 25px */
        height: 31px !important; /* anterior: 25px */
        top: 8px !important; /* anterior: 10px */
        right: 25px !important; /* anterior: 20px */
      }
      
      .nuvem {
        width: 30px !important; /* anterior: 40px */
        
      }
        
        /* ESTILOS DO MURAL */
/* Adicione estes estilos √† se√ß√£o de CSS */
.mural-container {
  border-radius: 15px;
  padding: 25px;
  margin-top: 30px;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(0, 0, 0, 0.05);
}
.tema-noite .mural-container {
  background: rgba(43, 57, 87, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.mural-container h2 {
  text-align: center;
  margin-bottom: 25px;
  color: #2C3E50;
  font-size: 1.8rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}
.tema-noite .mural-container h2 {
  color: #ecf0f1;
}

.mural-input-container {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 25px;
  background: #f8f9fa;
  padding: 20px;
  border-radius: 12px;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
}
.tema-noite .mural-input-container {
  background: #2c3e50;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.2);
}

.mural-input {
  flex: 1;
  min-width: 250px;
}

.mural-input input, .mural-input textarea {
  width: 100%;
  padding: 14px 18px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 1rem;
  margin-bottom: 12px;
  resize: none;
  transition: all 0.3s;
}
.mural-input input:focus, .mural-input textarea:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}
.tema-noite .mural-input input, 
.tema-noite .mural-input textarea {
  background: #3a506b;
  color: white;
  border: 1px solid #4a658a;
}
.tema-noite .mural-input input:focus, 
.tema-noite .mural-input textarea:focus {
  border-color: #1abc9c;
  box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.3);
}

.mural-input textarea {
  height: 120px;
}

.btn-enviar {
  padding: 14px 30px;
  border-radius: 30px;
  border: none;
  background: linear-gradient(135deg, #3498db, #2980b9);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1rem;
  box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}
.btn-enviar:hover {
  background: linear-gradient(135deg, #2980b9, #3498db);
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}
.tema-noite .btn-enviar {
  background: linear-gradient(135deg, #1abc9c, #16a085);
  box-shadow: 0 4px 15px rgba(26, 188, 156, 0.3);
}
.tema-noite .btn-enviar:hover {
  background: linear-gradient(135deg, #16a085, #1abc9c);
  box-shadow: 0 6px 20px rgba(26, 188, 156, 0.4);
}

.mural-mensagens {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 25px;
  margin-top: 20px;
}

.mensagem-item {
  padding: 25px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  animation: aparecer 0.5s ease;
  transform-origin: top left;
  transition: all 0.3s;
  overflow: hidden;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  background: white;
  border: 1px solid rgba(0,0,0,0.05);
}
.mensagem-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

@keyframes aparecer {
  0% { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.tema-noite .mensagem-item {
  background: #2c3e50;
  border: 1px solid rgba(255,255,255,0.05);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.mensagem-texto {
  margin: 15px 0;
  font-size: 1.1rem;
  line-height: 1.6;
  flex-grow: 1;
  color: #333;
}
.tema-noite .mensagem-texto {
  color: #ecf0f1;
}

.mensagem-info {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  color: #7f8c8d;
  border-top: 1px dashed rgba(0,0,0,0.1);
  padding-top: 12px;
  margin-top: 15px;
}
.tema-noite .mensagem-info {
  color: #bdc3c7;
  border-top: 1px dashed rgba(255,255,255,0.1);
}

.mensagem-autor {
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 5px;
  color: #3498db;
}
.tema-noite .mensagem-autor {
  color: #1abc9c;
}

.mensagem-hora {
  font-style: italic;
}

/* Efeito de gradiente nas mensagens */
.mensagem-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, #3498db, #1abc9c);
  opacity: 0.8;
}
.tema-noite .mensagem-item::before {
  background: linear-gradient(90deg, #1abc9c, #3498db);
}

/* Responsividade */
@media (max-width: 768px) {
  .mural-mensagens {
    grid-template-columns: 1fr;
  }
  
  .mural-input {
    min-width: 100%;
  }
  
  .btn-enviar {
    width: 100%;
    justify-content: center;
  }
}
        
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>√âpicos ‰∫ó üå±</h1>
      <div id="dataHoje"></div>
      <div id="info-semana"></div>
    </header>
    
    <div class="stats-container">
      <div class="global-stats">
        <div id="contadorGeral">0 √©picos focaram hoje!</div>
        <div class="progresso-container">
          <div id="progresso-barra"></div>
        </div>
      </div>
    </div>
    
    <div class="competicao-container">
      <h2>üèÜ Competi√ß√£o de Equipes</h2>
      <div class="equipes-competicao">
        <div class="equipe-competicao">
          <h3>üêù Abelha</h3>
          <div class="score" id="ranking-abelha">0</div>
          <div>Vit√≥rias</div>
        </div>
        <div class="equipe-competicao">
          <h3>üêû Joaninha</h3>
          <div class="score" id="ranking-joaninha">0</div>
          <div>Vit√≥rias</div>
        </div>
        <div class="equipe-competicao">
          <h3>üí° Vaga-lume</h3>
          <div class="score" id="ranking-vagalume">0</div>
          <div>Vit√≥rias</div>
        </div>
      </div>
      <p style="margin-top: 15px; font-size: 0.9em; color: #7f8c8d;">
        Competi√ß√£o semanal: Segunda a S√°bado.<br>
        A equipe com mais pontos ao final da competi√ß√£o ganha +1 ponto no ranking de equipes.<br>
        <strong>Em caso de empate, todas as equipes empatadas ganham +1 ponto.</strong>
      </p>
    </div>
    
    <div class="grupos-container">
      <!-- L√≠der Geral (AGORA DIN√ÇMICO) -->
      <div class="grupo" id="grupo-lider">
        <h2>L√≠der Geral</h2>
        <div id="lider">Carregando l√≠der...</div>
      </div>
      
      <!-- Equipes (AGORA DIN√ÇMICAS) -->
      <div id="equipe-abelha" class="grupo">Carregando equipe Abelha...</div>
      <div id="equipe-joaninha" class="grupo">Carregando equipe Joaninha...</div>
      <div id="equipe-vagalume" class="grupo">Carregando equipe Vaga-lume...</div>
    </div>
    
    <!-- SE√á√ÉO ATUALIZADA: √Årvore √âpica com espa√ßo id√™ntico ao c√≥digo de refer√™ncia -->
    <div class="arvore-epica-container">
      <h2>√Årvore √âpica</h2>
      
      <div class="tree-display">
        <!-- C√©u (fundo) -->
        <div class="tree-sky day-mode">
          <div class="stars-container"></div>
        </div>
        
        <!-- Sol com efeito de pulsa√ß√£o -->
        <div id="sol" class="sky-object">
          <img src="https://i.ibb.co/yFW4Lq73/sol.png" alt="Sol">
        </div>
        
        <!-- Lua sem efeito de pulsa√ß√£o -->
        <div id="lua" class="sky-object">
          <img src="https://i.ibb.co/LDdHmbP6/lua.png" alt="Lua">
        </div>
        
        <!-- Nuvens simplificadas (3 iniciais) -->
        <img class="nuvem nuvem-1" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        <img class="nuvem nuvem-2" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        <img class="nuvem nuvem-3" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        
        <!-- Novas nuvens (surgem ap√≥s as iniciais desaparecerem) -->
        <img class="nuvem nuvem-4" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        <img class="nuvem nuvem-5" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        <img class="nuvem nuvem-6" src="https://i.ibb.co/rfsS1Tp9/nuvem.png" alt="Nuvem">
        
        <!-- Grama mais verde e lisa -->
        <div class="ground"></div>
        
        <!-- √Årvores com posicionamento muito mais baixo e fases maiores -->
        <img id="seed" class="tree-image" src="https://i.ibb.co/7xsw9ZVd/semente.png" alt="Semente">
        <img id="sprout" class="tree-image" src="https://i.ibb.co/WNcWgWgn/broto.png" alt="Broto" style="display: none;">
        <img id="tree" class="tree-image" src="https://i.ibb.co/0jS2220Z/arvore.png" alt="√Årvore" style="display: none;">
        <!-- Nova imagem para flores -->
        <img id="flowers" class="tree-image" src="https://i.ibb.co/FrMst3S/flores.png" alt="Flores" style="display: none;">
        <img id="fruits" class="tree-image" src="https://i.ibb.co/9k6HjBFk/frutos.png" alt="Frutos" style="display: none;">
      </div>
      
      <div class="tree-info">
        <div class="stage-info" id="stage-name">Semente</div>
        <div class="stage-desc" id="stage-desc">A jornada come√ßa com um √∫nico dia de foco. Plante sua semente e cultive sua dedica√ß√£o di√°ria!</div>
        <div class="progresso-consecutivo">
          <strong>Dias consecutivos: <span id="dias-consecutivos">0</span></strong><br>
          <span id="proxima-fase"></span>
        </div>
      </div>
    </div>
    
    <!-- √Årea do mural de mensagens -->
<div class="mural-container">
  <h2><span>ü™ß</span> Mural de Mensagens</h2>
  
  <div class="mural-input-container">
    <div class="mural-input">
      <input type="text" id="mensagem-nome" placeholder="Seu nome (opcional, deixe em branco para 'Membro √âpico')">
      <textarea id="mensagem-texto" placeholder="Escreva sua mensagem motivacional, recado ou celebra√ß√£o..."></textarea>
    </div>
    
    <button class="btn-enviar" onclick="enviarMensagem()">
      <span>‚úâÔ∏è</span> Enviar Mensagem
    </button>
  </div>
  
  <div id="mural-mensagens" class="mural-mensagens">
    <!-- Mensagens ser√£o carregadas dinamicamente -->
  </div>
</div>
    
    <div class="medalha-info">
      <h2>Sistema de Medalhas</h2>
      <div class="medalhas-grid">
        <div class="medalha-item">
          <div class="medalha-emoji">üî•</div>
          <div class="medalha-nome">Fagulha</div>
          <div class="medalha-dias">3 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üëë</div>
          <div class="medalha-nome">Lenda</div>
          <div class="medalha-dias">10 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üåü</div>
          <div class="medalha-nome">Constante</div>
          <div class="medalha-dias">30 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üíé</div>
          <div class="medalha-nome">Diamante</div>
          <div class="medalha-dias">60 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üöÄ</div>
          <div class="medalha-nome">Foguete</div>
          <div class="medalha-dias">120 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üèÜ</div>
          <div class="medalha-nome">Trof√©u</div>
          <div class="medalha-dias">150 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üîÆ</div>
          <div class="medalha-nome">Bola de cristal</div>
          <div class="medalha-dias">240 dias</div>
        </div>
        <div class="medalha-item">
          <div class="medalha-emoji">üåû</div>
          <div class="medalha-nome">Solar</div>
          <div class="medalha-dias">365 dias</div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="popup"></div>
  <canvas id="confetti-canvas"></canvas>
  
  <!-- Elementos de √°udio -->
  <audio id="som-check" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
  <audio id="som-conquista" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

  <!-- Painel Secreto -->
  <div id="painel-secreto">
    <div class="painel-header">
      <h2>üîì Painel Secreto</h2>
      <button class="btn-fechar" onclick="document.getElementById('painel-secreto').style.display='none'; painelAberto=false">Fechar</button>
    </div>
    
    <div class="painel-secao">
      <h3>üë§ Pontos de Membro</h3>
      <div class="painel-controles">
        <select id="membro-pontos">
          <!-- Preenchido por JavaScript -->
        </select>
        <input type="number" id="quantidade-membro" value="1" min="-100" max="100">
        <button onclick="ajustarPontosMembro()">Aplicar</button>
      </div>
    </div>
    
    <div class="painel-secao">
      <h3>üèÜ Pontos da Semana</h3>
      <div class="painel-controles">
        <select id="equipe-pontos">
          <option value="abelha">Abelha</option>
          <option value="joaninha">Joaninha</option>
          <option value="vagalume">Vaga-lume</option>
        </select>
        <input type="number" id="quantidade-equipe" value="1" min="-100" max="100">
        <button onclick="ajustarPontosEquipe()">Aplicar</button>
      </div>
    </div>
    
    <div class="painel-secao">
      <h3>üèÖ Pontos do Ranking</h3>
      <div class="painel-controles">
        <select id="equipe-ranking">
          <option value="abelha">Abelha</option>
          <option value="joaninha">Joaninha</option>
          <option value="vagalume">Vaga-lume</option>
        </select>
        <input type="number" id="quantidade-ranking" value="1" min="-100" max="100">
        <button onclick="ajustarPontosRanking()">Aplicar</button>
      </div>
    </div>
    
<div class="painel-secao">
  <h3>üóëÔ∏è Gerenciar Mensagens</h3>
  <div class="painel-controles">
    <select id="mensagem-excluir">
      <!-- Preenchido por JavaScript -->
    </select>
    <button onclick="excluirMensagemSelecionada()">Excluir Selecionada</button>
    <button onclick="excluirTodasMensagens()" style="background:#e74c3c">Excluir Todas</button>
  </div>
</div>
    
    <div class="painel-secao">
      <h3>‚ö†Ô∏è Reset Geral</h3>
      <button onclick="resetarTudo()" style="width:100%;padding:12px;background:#e74c3c;color:white">Resetar Tudo</button>
    </div>
  </div>
</body>
  </html>
